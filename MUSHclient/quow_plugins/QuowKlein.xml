<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>

<!-- Klein bottle helper Created by Quow -->

<muclient>
<plugin
   name="QuowKlein"
   author="Quow"
   id="bff25308c015983fc2a56e3e"
   language="Lua"
   purpose="Klein Bottle Helper"
   date_written="2015-12-20"
   date_modified="2023-05-24"
   save_state="y"
   requires="4.84"
   version="0.06"
   >
</plugin>

<!--  Triggers  -->
<triggers>
  <trigger
   enabled="y"
   keep_evaluating="n"
   match="^Not quite inside, but within the glass itself, you can see (.+?) of (.+?) energy\.$"
   omit_from_output="n"
   sequence="30"
   script="QuowKleinFill"
   regexp="y"
   name="QuowKleinFullness"
  >
  </trigger>
  <!-- Set this trigger to enabled="y" if you want size notes when orbs are seen -->
  <trigger
   enabled="y"
   keep_evaluating="n"
   match="(?>a|A) (tiny speck|small point|moderately-sized ball|large orb|substantial sphere) of energy is tracing a (?:.+?) pattern in the air"
   sequence="30"
   script="QuowSpell"
   regexp="y"
   name="QuowSpellFloat"
  >
  </trigger>
</triggers>
<!--  Aliases  -->
<aliases>
</aliases>
<!--  Timers  -->
<timers>
</timers>

<script>
<![CDATA[

-- ********************************************************************
-- *****                    Quow's Klein Helper                   *****
-- ********************************************************************
function QuowKleinFill(sName, sLine, wildcards)
  if (wildcards[1] == "a barely noticeable wisp") then
    ColourNote("orange", "", "5 - 25 : No bonus - capture any size!")
  elseif (wildcards[1] == "a tiny swirl") then
    ColourNote("orange", "", "30 - 55  : No bonus - capture any size!")
  elseif (wildcards[1] == "a ripple") then
    ColourNote("orange", "", "60 - 85 : No bonus - capture any size!")
  elseif (wildcards[1] == "small waves") then
    ColourNote("orange", "", "90 - 115 : +1 Int, capture any size!")
  elseif (wildcards[1] == "eddying currents") then
    ColourNote("orange", "", "120 - 145 : +1 Int, capture any size!")
  elseif (wildcards[1] == "a turbulence") then
    ColourNote("orange", "", "150 - 175 : +1 Int, capture any size!")
  elseif (wildcards[1] == "a whirlpool") then
    ColourNote("orange", "", "180 - 205 : +1 Int, capture any size!")
  elseif (wildcards[1] == "a maelstrom") then
    ColourNote("orange", "", "210 - 235 : +1 Int, capture any size!")
  elseif (wildcards[1] == "a tempest") then
    ColourNote("orange", "", "240 - 265 : +2 Int, capture any EXCEPT substantial!")
  elseif (wildcards[1] == "a vortex") then
    ColourNote("orange", "", "270 - 295 : +2 Int, capture TINY ONLY!")
  elseif (wildcards[1] == "an impossible chaos") then
    ColourNote("orange", "", "296+ : +2 Int, do NOT capture ANY more spells!")
  end
end
sSpellSizes = {
  ["substantial sphere"] = "Substantial sphere is 40-50 thaums capture size.",
  ["large orb"] = "Large orb is 30-35 thaums capture size.",
  ["moderately-sized ball"] = "Moderate ball is 20-25 thaums capture size.",
  ["small point"] = "Small point is 10-15 thaums capture size.",
  ["tiny speck"] = "Tiny speck is 5 thaums capture size.",
}
objRexSpells = rex.new("(?>a|A) (tiny speck|small point|moderately-sized ball|large orb|substantial sphere) of energy is tracing a (?:.+?) pattern in the air")
function QuowSpell(sName, sLine, wildcards)
  -- Look for multiple spells of different sizes
  local bAnyLeft, iThisOffset, iTries, bSeenSize = true, 0, 0, {}
  while (bAnyLeft == true) do
    iRegexMatch, iLength, sMatchings = objRexSpells:match(sLine, iThisOffset)
    if (iRegexMatch ~= nil) then
      if (bSeenSize[sMatchings[1]] == nil) then
        ColourNote("orange", "", tostring(sSpellSizes[sMatchings[1]]))
        bSeenSize[sMatchings[1]] = true
      end
      iThisOffset = iLength
    else
      bAnyLeft = false
    end
    iTries = iTries + 1
    if (iTries > 50) then
      bAnyLeft = false
    end
  end
end
]]>
</script> 

</muclient>