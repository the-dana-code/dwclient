<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>

<!-- Mindspace calculator, Spellchecker, and magical TM Advisor for wizzards and witches, by Quow -->
<muclient>
<plugin
   name="QuowMindspace"
   author="Quow"
   id="bff25338e014986ba3b56e2c"
   language="Lua"
   purpose="Spellchecks, Mindspace and more"
   date_written="2016-08-25"
   date_modified="2024-11-01"
   save_state="y"
   requires="4.84"
   version="3.20"
   >
</plugin>
<script>
<![CDATA[

-- Check if the user has aliases enabled or not
if (GetCurrentValue("enable_aliases") ~= 1) then
  Note("")
  ColourNote("red", "", "Quow's Spellchecker & Mindspace Warning:")
  ColourNote("orange", "", "Your aliases in Mushclient are disabled!")
  Note("This means you will not be able to use the 'mindspace skills' command, or 'help mindspace', added by the plugin.")
  Note("To enable aliases, in Mushclient menus go to File->World Properties->Input->Aliases, tick 'Enable Aliases' on this page, then click 'OK'")
  Note("")
end

-- ************************************************
-- * Check if the user has timers enabled or not: *
-- ************************************************
if (GetCurrentValue("enable_timers") ~= 1) then
  SetOption ("enable_timers", 1)
  Note("")
  ColourNote(sCOLOUR.orange, "", "Quow's Mindspace Plugin Notice:")
  ColourNote(sCOLOUR.silver, "", "Your timers in MUSHclient were disabled.  Timers are needed for many features throughout Quow's plugins.")
  ColourNote(sCOLOUR.silver, "", "This plugin has now force-enabled timers in your MUSHclient world settings for you, you do not need to do anything!")
  Note("")
end

function QuowMindspaceHelp (sName, sLine, wildcards)
  ColourNote("darkorange", "", "Quow's Mindspace & Spellcheck Plugin Helpfile:")
  ColourNote("silver", "",     "=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "mindspace help")
  ColourNote("silver", "",     "'            :  This help information")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "mindspace version")
  ColourNote("silver", "",     "'         :  Mindspace plugin version info")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "spells")
  ColourNote("silver", "",     "'                    :  Show all remembered spells with mindspace used/free information added")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "spells uncategorised")
  ColourNote("silver", "",     "'      :  Show all remembered spells with mindspace used/free information added, uncategorised")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "mindspace screenreader")
  ColourNote("silver", "",     "'    :  Toggle between normal output, and screenreader friendlier output")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "mindspace su <character>")
  ColourNote("silver", "",     "'  :  Manually switch the plugin to the specified alt.")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "mindspace alts")
  ColourNote("silver", "",     "'            :  List any alts the mindspace plugin has logged data for so far.")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "mindspace book <3-16>")
  ColourNote("silver", "",     "'     :  List all spells in matching UU Library book number")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "mindspace books")
  ColourNote("silver", "",     "'           :  List all wizzard spellbooks with clickable links to list their spells")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "mindspace book")
  ColourNote("silver", "",     "'            :  List all spells in the book of the last spell you just looked up")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "mindspace stats")
  ColourNote("silver", "",     "'           :  Show total cast statistics recorded by the plugin so far.  Use 'statreset' to reset current alt stats.")
  ColourNote("silver", "",     "                               (use 'mindspace stats <altname>' to view stats for a specific alt only)")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "mindspace primaries")
  ColourNote("silver", "",     "'       :  List your primary skills (if known by the plugin).")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "mindspace orders")
  ColourNote("silver", "",     "'          :  List the known wizzard Orders and their themes.")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "mindspace order <name or number>")
  ColourNote("silver", "",     "':  Look up more detailed information on a specific order, eg 'mindspace order 1' or 'mindspace order red'")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "mindspace orders <spells>")
  ColourNote("silver", "",     "' :  List suggested Orders based on number of primaries for the given spells")
  ColourNote("silver", "",     "                               Separate with commas, eg 'mindspace orders tpa,jpct,dkdd,tig'")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "mindspace sorted")
  ColourNote("silver", "",     "'          :  List all spells ordered by easiest to hardest, colour-coded based on your skills")
  ColourNote("silver", "",     "                               Optionally add type, category, or max-mindspace, examples are;")
  ColourNote("darkorange", "",     "                              'mindspace sorted def 15' 'mindspace sorted 20', 'mindspace sorted witch misc 30'")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "mindspace spells")
  ColourNote("silver", "",     "'          :  List all spells in mindspace size order, colour-coded to ones you have remembered")
  ColourNote("silver", "",     "                               Optionally add type, category, or max-mindspace, examples are;")
  ColourNote("darkorange", "",     "                              'mindspace spells 15' 'mindspace spells misc', 'mindspace spells witch off 15'")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "mindspace <spell acronym>")
  ColourNote("silver", "",     "' :  Lookup spellname, GP cost, mindspace, and full spellcheck data, eg 'mindspace tpa'")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "mindspace <skillname>")
  ColourNote("silver", "",     "'     :  List ALL spells that use these skill(s) , and suggest TM worthy spells")
  ColourNote("silver", "",     "                               Must be skill names only, and comma-separated, eg 'mindspace fire'  'mindspace channeling,summoning'")
  ColourNote("silver", "",     "                               You can also set a maximum mindspace size at the end with for example; 'mindspace fire 30' or 'mindspace air,earth 20'")

  ColourTell("silver", "",     "'")
  ColourTell("darkorange", "", "mindspace skills")
  ColourNote("silver", "",     "'          :  Record all your skill bonuses for the plugin, repeat after large skill or stat changes")

end


sQuowSkillLevels = {
  [1] =  "<1% chance ",
  [2] =  "10% chance ",
  [3] =  "20% chance ",
  [4] =  "30% chance ",
  [5] =  "40% chance ",
  [6] =  "50% chance ",
  [7] =  "60% chance ",
  [8] =  "70% chance ",
  [9] =  "80% chance ",
  [10] = "90% chance ",
  [11] = "99+% chance",
}

sQuowBooks = {
  [12] = {"Invoakatyons in thee Mysterie of Wynd",                            "rather torn volume",           "UU Library:  [Book 3] @ 20 Thaums (row 4, column 2)", 3},
  [14] = {"Spelles of thee Arte of Fyre",                                     "slightly charred grimoire",    "UU Library:  [Book 4] @ 25 Thaums (row 5, column 7)", 4},
  [17] = {"Thee Dyscyplyne of thee Stoane",                                   "weighty tome",                 "UU Library:  [Book 6] @ 30 Thaums (row 6, column 6)", 6},
  [5]  = {"Cunjuryng for Begynners",                                          "nice and shiny book",          "UU Library:  [Book 7] @ 35 Thaums (row 7, column 1)", 7},
  [11] = {"Introeductyon too thee Strukture of thee Multyverss",              "well-read volume",             "UU Library:  [Book 8] @ 50 Thaums (row 10, column 8)", 8},
  [2]  = {"Ae Thouesand and Onne Thyngs ae Boye cann Do with Corpse Partes",  "skin-bound grimoire",          "UU Library:  [Book 9] @ 55 Thaums (row 11, column 5)", 9},
  [7]  = {"Everything You Ever Wanted to Know About Everything",              "mysterious book",              "UU Library:  [Book 10] @ 75 Thaums (row 15, column 3)", 10},
  [16] = {"The Olde Arte of Foode",                                           "sticky grimoire",              "UU Library:  [Book 11] @ 80 Thaums (row 16, column 4)", 11},
  [19] = {"Weather Magick",                                                   "impressive grimoire",          "UU Library:  [Book 12] @ 85 Thaums (row 17, column 7)", 12},
  [10] = {"Intermediate Artifact Magic, fourth ed.",                          "solid book",                   "UU Library:  [Book 13] @ 95 Thaums (row 19, column 1)", 13},
  [4]  = {"Body Parts for the Advanced Student",                              "bone book",                    "UU Library:  [Book 14] @ 110 Thaums (row 22, column 6)", 14},
  [13] = {"My Firste Demon-Summoning Booke! By Beatrix Faust",                "cheerful yellow book",         "UU Library:  [Book 15] @ 110 Thaums (row 22, column 8)", 15},
  [21] = {"Spells of Thee Moste Ceremonious Rite of AshkEnte",                "plain black book",             "UU Library:  [Book 16] @ 115 Thaums (row 23, column 3)", 16},
  [1]  = {"Advanced Arts and Sciences of the Cunning Artificer",              "filigreed hardcover",          "Bes Pelargic Library:  random spot of the 4 book locations"},
  [3]  = {"Begynners' Magick",                                                "tome",                         "Any Gym practise room"},
  [6]  = {"Divinational Arts",                                                "origami tome",                 "Bes Pelargic Library:  random spot of the 4 book locations"},
  [8]  = {"Heavenly Arts",                                                    "gemmed volume",                "Bes Pelargic Library:  random spot of the 4 book locations"},
  [9]  = {"Illusionary Arts",                                                 "shimmering grimoire",          "Bes Pelargic Library:  random spot of the 4 book locations"},
  [15] = {"Spelles of thee Oryent",                                           "date encrusted grimoire",      "IIL Library, DJB:  Back-right/East"},
  [18] = {"Thee Secrets of Artifyce and Crafte",                              "imposing bronze book",         "AoA Library, Sto Lat:  second aisle, first aisle, first aisle"},
  [20] = {"Ye Booke of Polymorphe",                                           "[book appearance changes]",    "IIL Library, DJB:  Back-left/West"},
  [22] = {"Jorodin",                                                          "Jorodin",                      "Jorodin's Shop, Short Street, AM"},
  [23] = {"Pracktical Hedgecrafte",                                           "bark-bound book",              "Hedge Outpost, Skund Forest"},
}

-- Order details
sQuowOrders = {
  [1] = {"Circle / White         ", "Elementalists"},
  [2] = {"Hoodwinkers / Blue     ", "Illusions"},
  [3] = {"Lodgers / Red          ", "Thaumaturgy"},
  [4] = {"Silver Star / Brown    ", "Magical Artifacts"},
  [5] = {"Seers / Green          ", "Lore and Knowledge"},
  [6] = {"Shadow / Black         ", "Demonology"},
  [7] = {"Midnight / Grey        ", "Necromancy"},
  [8] = {"Last Order / Octarine  ", "Octarine Killers"},
}

-- Reverse user-entered shorts for order-data
sOrderShorts = {
  ["circle"] = 1, ["white"] = 1,
  ["hoodwinkers"] = 2, ["blue"] = 2,
  ["lodgers"] = 3, ["red"] = 3,
  ["silver"] = 4, ["star"] = 4, ["silver star"] = 4, ["silverstar"] = 4, ["brown"] = 4,
  ["seer"] = 5, ["seers"] = 5, ["green"] = 5,
  ["shadow"] = 6, ["shadows"] = 6, ["black"] = 6,
  ["midnight"] = 7, ["grey"] = 7,
  ["last"] = 8, ["lastorder"] = 8, ["pk"] = 8, ["last order"] = 8, ["octarine"] = 8,
}

-- Data on the skills we care about
sQuowSkillTree = {
  ["air"] =        {"ma.me.el.air",        {1, 2}},
  ["earth"] =      {"ma.me.el.earth",      {1}},
  ["fire"] =       {"ma.me.el.fire",       {1, 6, 8}},
  ["water"] =      {"ma.me.el.water",      {1}},
  ["animating"] =  {"ma.me.me.animating",  {2, 3, 5, 7, 8}},
  ["channeling"] = {"ma.me.me.channeling", {1, 2, 3, 5, 8}},
  ["charming"] =   {"ma.me.me.charming",   {2, 6, 7}},
  ["convoking"] =  {"ma.me.me.convoking",  {1, 2, 3, 5, 7, 8}},
  ["cursing"] =    {"ma.me.me.cursing",    {6}},
  ["binding"] =    {"ma.me.ph.binding",    {1, 2, 3, 4, 5, 6, 7, 8}},
  ["brewing"] =    {"ma.me.ph.brewing",    {}},
  ["chanting"] =   {"ma.me.ph.chanting",   {6}},
  ["dancing"] =    {"ma.me.ph.dancing",    {3, 6}},
  ["enchanting"] = {"ma.me.ph.enchanting", {3, 4, 5, 7}},
  ["evoking"] =    {"ma.me.ph.evoking",    {1, 2, 3, 5, 8}},
  ["healing"] =    {"ma.me.ph.healing",    {7}},
  ["scrying"] =    {"ma.me.ph.scrying",    {5, 8}},
  ["abjuring"] =   {"ma.me.sp.abjuring",   {6, 7}},
  ["banishing"] =  {"ma.me.sp.banishing",  {6}},
  ["conjuring"] =  {"ma.me.sp.conjuring",  {2}},
  ["divining"] =   {"ma.me.sp.divining",   {5}},
  ["summoning"] =  {"ma.me.sp.summoning",  {1, 2, 3, 6, 7, 8}},
  ["wand"] =       {"ma.it.he.wand",       {4}},
  ["rod"] =        {"ma.it.he.rod",        {4}},
  ["staff"] =      {"ma.it.he.staff",      {1, 2, 3, 4, 5, 6, 7, 8}},
  ["amulet"] =     {"ma.it.wo.amulet",     {}},
  ["ring"] =       {"ma.it.wo.ring",       {4}},
  ["talisman"] =   {"ma.it.talisman",      {}},
  ["gold"] =       {"cr.sm.gold",          {4}},
  ["silver"] =     {"cr.sm.silver",        {}},
  ["turning"] =    {"cr.ca.turning",       {4}},
  ["whittling"] =  {"cr.ca.whittling",     {4}},
  ["herbal"] =     {"cr.hus.pl.herbal",    {}},
  ["shaping"] =    {"cr.pot.fo.shaping",   {}},
  ["weaving"] =    {"cr.ma.weaving",       {}},
}

-- Setup who has primaries
for sThisSkill, objSkillData in pairs(sQuowSkillTree) do
  sQuowSkillTree[sThisSkill][3] = {}
  for __, iThisOrder in pairs(objSkillData[2]) do
    sQuowSkillTree[sThisSkill][3][iThisOrder] = true
  end
end

iQuowSkillOrder = {
  [1] = "air", [2] = "earth", [3] = "fire", [4] = "water", [5] = "animating", [6] = "channeling", [7] = "charming", 
  [8] = "convoking", [9] = "cursing", [10] = "binding", [11] = "brewing", [12] = "chanting", [13] = "dancing", [14] = "enchanting", 
  [15] = "evoking", [16] = "healing", [17] = "scrying", [18] = "abjuring", [19] = "banishing", [20] = "conjuring", [21] = "divining", 
  [22] = "summoning", [23] = "wand", [24] = "rod", [25] = "staff", [26] = "amulet", [27] = "ring", [28] = "talisman", [29] = "gold", 
  [30] = "silver", [31] = "turning", [32] = "whittling", [33] = "herbal", [34] = "shaping", [35] = "weaving",
}


-- Add spells to this array - spellname is the array key, value is an array of things like mindspace, GP, type, methods etc.
objQuowSpellData = {
  ["A Cup of Tea and Sake"]                          = {5, "cts",  "Miscellaneous", 25, 6, 
      {
        {"channeling",          31,  41,  52,  58,  61,  74,  80,  97, 120, 156},
        {"divining",            94, 101, 110, 117, 123, 137, 142, 152, 184, 206},
        {"scrying",            140, 146, 156, 162, 169, 175, 182, 190, 220, 250},
      }, false, "paper (consumed)"
    },
  ["Al'Hrahaz's Scintillating Blorpler"]             = {25, "ahsb", "Miscellaneous", 90, 15, 
      {
        {"evoking",            189, 197, 203, 211, 218, 228, 236, 250, 269, 310},
        {"channeling",         225, 232, 243, 249, 255, 265, 272, 285, 310, 340},
        {"evoking",            185, 194, 198, 207, 212, 220, 228, 243, 260, 301},
        {"chanting",           203, 212, 221, 228, 234, 246, 252, 270, 280, 315},
        {"chanting",           230, 237, 246, 255, 259, 270, 277, 294, 310, 345},
      }, false, "octogram, wearable jewellery (to blorp)"
    },
  ["Amazing Silicate Blorpler"]                      = {5,  "asb",  "Miscellaneous", 10, 3, 
      {
        {"evoking",             60,  65,  70,  75,  80,  85,  90,  95, 105, 115},
        {"channeling",          40,  45,  50,  55,  60,  65,  70,  80,  90, 100},
        {"evoking",             60,  65,  70,  75,  80,  85,  90,  95, 105, 115},
        {"chanting",            50,  55,  60,  65,  70,  75,  80,  85,  95, 105},
        {"chanting",            50,  55,  60,  65,  70,  75,  80,  85,  90, 105},
      }, false, "rock (to blorp)",
    },
  ["Atmospheric Inscription Wonder"]                 = {25, "aiw",  "Miscellaneous", 80, 14, 
      {
        {"animating",           92, 101, 109, 115, 121, 134, 140, 155, 178, 205},
        {"fire",                76,  84,  94, 101, 107, 117, 123, 142, 160, 190},
        {"binding",             86,  94, 103, 111, 117, 128, 134, 152, 170, 200},
        {"channeling",          84,  92, 101, 109, 115, 126, 132, 149, 165, 195},
      }, false, "quill (consumed), torch (consumed)"
    },
  ["Bifram's Amazing Fireworks"]                     = {15, "baf",  "Miscellaneous", 50, 14, 
      {
        {"animating",           90,  98, 108, 115, 121, 132, 139, 157, 179, 200},
        {"fire",                79,  87,  96, 104, 110, 121, 126, 146, 168, 190},
        {"binding",            106, 115, 124, 130, 137, 148, 153, 170, 190, 210},
        {"channeling",         104, 113, 121, 128, 133, 143, 150, 168, 187, 205},
      }, false, "torch (consumed)"
    },
  ["Booch's Extremal Polymorphism"]                  = {50, "bep",  "Miscellaneous", 70, 20, 
      {
        {"channeling",         164, 172, 180, 187, 193, 205, 211, 226, 250, 280},
        {"convoking",          164, 172, 180, 187, 193, 205, 211, 226, 250, 280},
        {"evoking",            172, 178, 185, 193, 199, 211, 217, 234, 255, 290},
        {"binding",            166, 174, 182, 190, 195, 210, 215, 232, 252, 282},
        {"animating",          168, 176, 184, 192, 197, 212, 217, 234, 254, 285},
      }, false, "dwarf arm, human arm, troll arm (all consumed)"
    },
  ["Boolywog's Forbidden Pleasures"]                 = {10, "bfp",  "Miscellaneous", 25, 3, 
      {
        {"chanting",            40,  45,  50,  55,  60,  65,  70,  80,  90, 100},
        {"charming",            50,  55,  60,  65,  70,  75,  80,  90, 100, 110},
        {"summoning",           80,  90, 100, 105, 110, 115, 120, 130, 140, 150},
      }, false, "octogram, potato (consumed)"
    },
  ["Brassica Oleracea Ambulata"]                     = {10, "boa",  "Miscellaneous", 25, 5, 
      {
        {"evoking",             57,  65,  76,  82,  88,  99, 105, 123, 144, 185},
        {"channeling",          61,  70,  78,  86,  91, 103, 109, 125, 148, 188},
        {"animating",           74,  82,  90,  99, 104, 115, 121, 138, 161, 198},
      }, false, "none"
    },
  ["Brother Happalon's Elementary Enchanting"]       = {5,  "bhee", "Miscellaneous", 35, 11, 
      {
        {"evoking",             50,  55,  60,  65,  70,  75,  90, 105, 120, 135},
        {"enchanting",          70,  75,  80,  85,  90,  95, 105, 120, 135, 155},
        {"chanting",            60,  65,  70,  75,  80,  85,  95, 110, 130, 145},
        {"enchanting",          75,  80,  90, 100, 105, 110, 120, 135, 150, 160},
      }, false, "blue funnel (sometimes consumed)"
    },
  ["Calm Embrace of Illusionary Beauty"]             = {25, "ceib", "Offensive",     50, 9, 
      {
        {"conjuring",          150, 155, 160, 170, 175, 180, 185, 190, 205, 220},
        {"charming",           160, 170, 180, 190, 195, 200, 205, 215, 225, 245},
        {"staff",              160, 170, 180, 190, 195, 200, 205, 215, 225, 245},
        {"air",                150, 155, 160, 170, 175, 180, 185, 190, 205, 225},
      }, false, "staff, fire cracker or firecracker (consumed)"
    },
  ["Cherry Blossoms in Bloom"]                       = {10, "cbb",  "Miscellaneous", 25, 9, 
      {
        {"air",                115, 120, 130, 135, 140, 145, 150, 160, 170, 185},
        {"channeling",         130, 140, 150, 155, 160, 165, 170, 180, 190, 200},
        {"convoking",          115, 120, 130, 135, 140, 145, 150, 160, 170, 185},
      }, false, "octogram"
    },
  ["Chrenedict's Corporeal Covering"]                = {25, "ccc",  "Defensive",     60, 17, 
      {
        {"binding",            125, 130, 140, 145, 150, 155, 160, 165, 175, 180},
        {"earth",              130, 135, 145, 150, 155, 160, 165, 175, 180, 190},
        {"binding",            190, 200, 210, 215, 220, 225, 230, 240, 250, 270},
      }, false, "sap, varnish, agent [chalk, latex, filings] - all consumed"
    },
  ["Collatrap's Instant Pickling Stick"]             = {10, "cips", "Miscellaneous", 20, 3, 
      {
        {"conjuring",           70,  80,  90,  95, 100, 110, 115, 125, 130, 140},
        {"evoking",             90, 100, 110, 115, 120, 130, 140, 150, 160, 170},
        {"wand",               115, 125, 135, 145, 150, 155, 165, 174, 183, 192},
        {"dancing",             70,  80,  90,  95, 100, 110, 115, 125, 130, 140},
      }, false, "none"
    },
  ["Crondor's Fabulous Detection"]                   = {10, "cfd",  "Miscellaneous", 25, 10, 
      {
        {"staff",               89,  98, 108, 114, 120, 132, 138, 156, 175, 210},
        {"gold",                94, 102, 110, 118, 124, 134, 140, 158, 178, 214},
        {"turning",             81,  89, 100, 106, 112, 124, 130, 148, 170, 204},
      }, false, "gold ring, staff"
    },
  ["Crondor's Marvellous Sequestration"]             = {60, "cms2", "Miscellaneous", 350, 18, 
      {
        {"staff",              178, 184, 189, 194, 199, 204, 209, 222, 235, 263},
        {"ring",               276, 281, 286, 291, 297, 302, 310, 316, 328, 360},
        {"convoking",          202, 208, 214, 220, 226, 232, 240, 249, 268, 286},
        {"enchanting",         275, 280, 285, 290, 295, 300, 305, 316, 330, 368},
        {"binding",            275, 281, 286, 291, 296, 303, 309, 320, 333, 364},
      }, false, "octogram, sapphire ring (consumed), handful of pmp (consumed)"
    },
  ["Crondor's Mysterious Sparkling"]                 = {40, "cms",  "Miscellaneous", 150, 10, 
      {
        {"staff",              100, 105, 110, 115, 125, 130, 140, 146, 160, 180},
        {"whittling",           75,  85,  90, 100, 105, 113, 120, 128, 141, 160},
        {"binding",             90,  95, 100, 105, 115, 120, 130, 136, 150, 190},
        {"enchanting",         105, 110, 115, 120, 128, 132, 142, 155, 185, 210},
      }, false, "octogram, ankhstone (consumed)"
    },
  ["Dismal Digit of Doom"]                           = {10, "ddd",  "Miscellaneous", 30, 2, 
      {
        {"enchanting",          30,  35,  40,  45,  50,  55,  65,  75,  85, 100},
        {"healing",             60,  65,  70,  75,  80,  85,  90, 100, 115, 130},
        {"binding",             70,  75,  80,  85,  90, 100, 110, 120, 130, 140},
        {"animating",          105, 110, 115, 120, 130, 140, 150, 160, 170, 180},
      }, false, "index finger (consumed), pinch of chalk powder (consumed)"
    },
  ["Doctor Kelleflump's Deadly Demon"]               = {60, "dkdd", "Offensive",     55, 13, 
      {
        {"dancing",            291, 300, 306, 315, 322, 330, 337, 355, 377, 414},
        {"cursing",            284, 293, 302, 311, 316, 326, 333, 350, 369, 410},
        {"summoning",          293, 302, 313, 319, 324, 337, 344, 358, 381, 421},
        {"abjuring",           295, 304, 315, 321, 326, 337, 344, 358, 381, 421},
        {"banishing",          293, 300, 311, 317, 322, 333, 339, 353, 379, 419},
      }, false, "human heart (consumed)"
    },
  ["Doctor Worblehat's Flaming Primate Premonition"] = {25, "dwfpp","Miscellaneous", 100, 18, 
      {
        {"turning",            172, 185, 190, 195, 200, 205, 214, 221, 236, 260},
        {"gold",               204, 209, 214, 219, 224, 231, 236, 250, 280, 286},
        {"enchanting",         230, 236, 241, 246, 251, 256, 261, 281, 288, 310},
        {"binding",            254, 260, 265, 270, 276, 281, 286, 296, 313, 333},
      }, false, "octogram, knife, small rowan orb (consumed), red crystal (consumed), gold ring (consumed)"
    },
  ["Duander's Thaumic Luminosity Disperser"]         = {20, "dtld", "Miscellaneous", 30, 14, 
      {
        {"chanting",            17,  25,  31,  40,  46,  58,  64,  82, 103, 145},
        {"fire",                49,  58,  67,  76,  82,  91,  97, 115, 136, 175},
        {"channeling",          52,  61,  70,  79,  85,  94, 100, 118, 139, 178},
        {"banishing",           91, 100, 112, 117, 123, 133, 139, 160, 175, 210},
      }, false, "none"
    },
  ["Effermhor's Hypersonic Assault"]                 = {30, "eha",  "Offensive",     40, 12, 
      {
        {"evoking",            160, 165, 170, 175, 180, 185, 190, 200, 225, 240},
        {"channeling",         160, 165, 170, 175, 180, 185, 190, 200, 220, 240},
        {"binding",            160, 165, 170, 175, 180, 185, 190, 200, 220, 240},
        {"dancing",            180, 185, 190, 195, 200, 210, 220, 230, 240, 260},
        {"air",                180, 185, 190, 195, 200, 205, 210, 220, 240, 260},
      }, false, "jar of screaming mandrake roots, beeswax candle (consumed)"
    },
  ["Ellamandyr's Hyaline Amulet"]                    = {10, "eha2", "Miscellaneous", 15, 18, 
      {
        {"wand",               127, 132, 138, 144, 150, 158, 164, 183, 210, 243},
        {"water",              100, 106, 111, 116, 121, 129, 135, 154, 181, 215},
        {"binding",            176, 182, 190, 195, 200, 208, 214, 233, 260, 291},
        {"silver",              96, 101, 106, 111, 116, 124, 130, 149, 176, 210},
      }, false, "wand, silver necklace (consumed), water (minimum 2 pints)"
    },
  ["Endorphin's Floating Friend"]                    = {20, "eff",  "Defensive",     30, 11, 
      {
        {"evoking",             80,  90, 100, 105, 110, 120, 130, 140, 150, 160},
        {"animating",          110, 115, 125, 135, 140, 150, 160, 170, 180, 185},
        {"binding",            120, 130, 140, 150, 160, 170, 180, 190, 200, 210},
      }, false, "shield (to float)"
    },
  ["Eringyas' Surprising Bouquet"]                   = {10, "esb",  "Miscellaneous", 10, 3, 
      {
        {"channeling",          55,  65,  70,  75,  80,  85,  90,  95, 100, 110},
        {"evoking",             40,  45,  50,  55,  60,  65,  70,  75,  80,  90},
        {"charming",            30,  35,  40,  45,  50,  55,  60,  65,  70,  80},
      }, false, "none"
    },
  ["Fabrication Classification Identification"]      = {15, "fci",  "Miscellaneous", 45, 11, 
      {
        {"divining",            57,  65,  74,  83,  88,  98, 105, 122, 147, 184},
        {"evoking",             76,  83,  94,  99, 105, 116, 122, 140, 162, 202},
        {"convoking",           72,  81,  87,  94, 101, 112, 118, 138, 158, 197},
      }, false, "none"
    },
  ["Fiddelmaker's Auriferous Embrace"]               = {20, "fae",  "Offensive",     50, 18, 
      {
        {"wand",               200, 205, 215, 220, 230, 240, 250, 260, 270, 290},
        {"gold",               210, 220, 230, 235, 240, 250, 260, 270, 280, 300},
        {"animating",          200, 205, 215, 220, 230, 240, 250, 260, 270, 290},
      }, false, "wand, gold ring (consumed)"
    },
  ["Finneblaugh's Thaumic Float"]                    = {20, "ftf",  "Miscellaneous", 40, 12, 
      {
        {"air",                175, 180, 190, 200, 205, 210, 220, 230, 240, 260},
        {"evoking",            190, 200, 210, 215, 225, 240, 255, 265, 275, 285},
        {"summoning",          200, 210, 220, 225, 235, 250, 265, 270, 280, 290},
        {"air",                215, 225, 235, 245, 255, 260, 270, 280, 290, 300},
      }, false, "feather (consumed)"
    },
  ["Floron's Fabulous Mirror"]                       = {15, "ffm",  "Miscellaneous", 40, 7, 
      {
        {"channeling",         115, 124, 130, 139, 144, 154, 160, 178, 196, 240},
        {"divining",           124, 129, 139, 145, 154, 160, 169, 187, 208, 245},
        {"scrying",            199, 205, 214, 223, 229, 238, 244, 262, 286, 315},
      }, false, "mirror"
    },
  ["Friddlefrod's Hydratic Extrusion"]               = {10, "fhe",  "Miscellaneous", 10, 3, 
      {
        {"water",               45,  50,  60,  65,  70,  75,  80,  90, 100, 110},
        {"evoking",             60,  70,  80,  85,  90,  95, 100, 110, 120, 130},
        {"water",               80,  90, 100, 105, 110, 115, 120, 125, 130, 140},
      }, false, "none"
    },
  ["Frygellhan's Fiendish Orbit Disruptor"]          = {15, "ffod", "Offensive",     25, 11, 
      {
        {"evoking",             75,  80,  90,  95, 100, 105, 115, 120, 130, 140},
        {"channeling",         120, 125, 135, 140, 150, 155, 160, 170, 175, 185},
        {"binding",            130, 140, 150, 160, 170, 180, 190, 200, 210, 225},
      }, false, "iron chain"
    },
  ["Fyodor's Nimbus of Porterage"]                   = {35, "fnp",  "Miscellaneous", 75, 12, 
      {
        {"water",              105, 110, 120, 125, 130, 135, 140, 150, 160, 170},
        {"fire",                90,  95, 100, 110, 115, 120, 130, 140, 150, 160},
        {"air",                110, 120, 125, 130, 135, 140, 150, 164, 183, 200},
        {"summoning",          125, 130, 140, 145, 150, 160, 175, 184, 203, 215},
        {"abjuring",            90,  95, 100, 110, 115, 120, 130, 140, 150, 160},
        {"channeling",         150, 160, 165, 175, 180, 185, 190, 200, 215, 230},
      }, false, "candle, wet towel (gets damaged)"
    },
  ["G'flott's Olfactory Nightmare"]                  = {30, "gon",  "Offensive",     40, 12, 
      {
        {"evoking",            160, 165, 170, 175, 180, 185, 195, 205, 220, 240},
        {"air",                160, 165, 170, 175, 180, 185, 195, 205, 220, 240},
        {"dancing",            170, 175, 180, 185, 190, 195, 205, 215, 230, 250},
        {"fire",               160, 165, 170, 175, 180, 185, 195, 205, 220, 240},
        {"air",                180, 185, 190, 195, 200, 205, 210, 220, 240, 260},
      }, false, "block of sulphur (consumed)"
    },
  ["Gillimer's Ring of Temperate Weather"]           = {25, "grtw", "Miscellaneous", 100, 19, 
      {
        {"gold",               191, 200, 211, 218, 223, 232, 240, 260, 282, 315},
        {"binding",            207, 216, 224, 231, 238, 249, 254, 273, 295, 330},
        {"enchanting",         194, 200, 211, 218, 223, 236, 242, 260, 282, 318},
        {"ring",               194, 200, 211, 218, 223, 236, 242, 260, 282, 318},
      }, false, "gold ring (consumed)"
    },
  ["Grisald's Chilly Touch"]                         = {5,  "gct",  "Miscellaneous", 10, 3, 
      {
        {"summoning",           60,  70,  80,  85,  90,  95, 100, 110, 120, 130},
        {"healing",             80,  90, 100, 105, 110, 115, 120, 130, 140, 150},
      }, false, "none"
    },
  ["Grisald's Reanimated Guardian"]                  = {40, "grg",  "Defensive",     70, 4, 
      {
        {"summoning",          170, 180, 185, 190, 195, 200, 205, 210, 230, 255},
        {"binding",            170, 180, 185, 190, 195, 200, 205, 210, 230, 255},
        {"animating",          155, 160, 165, 170, 175, 180, 185, 190, 205, 215},
        {"healing",            260, 270, 275, 280, 285, 295, 305, 315, 325, 335},
      }, false, "fully intact human corpse (consumed)"
    },
  ["Gryntard's Feathery Reliever"]                   = {25, "gfr",  "Miscellaneous", 60, 12, 
      {
        {"summoning",          130, 140, 150, 155, 160, 165, 170, 180, 190, 210},
        {"air",                140, 150, 160, 170, 180, 185, 195, 205, 220, 240},
        {"binding",            125, 135, 140, 145, 150, 155, 160, 170, 180, 200},
        {"channeling",         155, 160, 170, 175, 180, 185, 195, 205, 220, 240},
      }, false, "feather (consumed), silver necklace"
    },
  ["Heezlewurst's Elemental Buffer"]                 = {30, "heb",  "Defensive",     50, 11, 
      {
        {"channeling",         150, 155, 165, 170, 175, 185, 195, 205, 215, 230},
        {"evoking",            170, 180, 185, 190, 200, 205, 215, 225, 235, 250},
        {"binding",            155, 165, 170, 175, 180, 190, 200, 210, 220, 240},
        {"enchanting",         155, 165, 170, 175, 180, 190, 200, 210, 220, 240},
        {"convoking",          185, 190, 200, 210, 220, 230, 240, 250, 260, 280},
      }, false, "octogram (consumed), small rhokshial crystal (consumed - can use multiple crystals)"
    },
  ["Independent Recurring Vocaliser"]                = {5,  "irv",  "Miscellaneous", 15, 3, 
      {
        {"channeling",          50,  55,  60,  65,  70,  75,  85,  95, 105, 120},
        {"binding",             90, 100, 110, 115, 120, 125, 130, 140, 150, 160},
        {"evoking",             60,  65,  70,  75,  80,  85,  95, 105, 115, 130},
      }, false, "none"
    },
  ["Jogloran's Portal of Cheaper Travel"]            = {20, "jpct", "Miscellaneous", 100, 11, 
      {
        {"enchanting",         130, 140, 150, 155, 160, 170, 180, 192, 205, 220},
        {"evoking",            130, 140, 150, 155, 160, 170, 180, 192, 205, 220},
        {"binding",            130, 140, 150, 155, 160, 170, 180, 192, 210, 225},
        {"dancing",            130, 140, 150, 155, 160, 170, 180, 192, 210, 225},
        {"banishing",          160, 165, 170, 180, 190, 200, 210, 222, 235, 250},
      }, false, "blorped jewellery or rock"
    },
  ["Jorodin's Magnificent Communicator"]             = {20, "jmc",  "Miscellaneous", 50, 22, 
      {
        {"channeling",         159, 168, 178, 183, 188, 200, 206, 224, 248, 284},
        {"binding",            156, 166, 176, 182, 188, 200, 205, 222, 241, 281},
        {"evoking",            123, 130, 140, 146, 154, 166, 171, 188, 212, 248},
      }, false, "none"
    },
  ["Journey of the Heavenly Storm Dragon"]           = {75, "jhsd", "Offensive",     100, 8, 
      {
        {"water",              320, 334, 344, 349, 354, 365, 372, 389, 410, 449},
        {"air",                320, 334, 344, 349, 354, 365, 372, 389, 410, 449},
        {"earth",              320, 334, 344, 349, 354, 365, 372, 389, 410, 449},
        {"fire",               320, 334, 344, 349, 354, 365, 372, 389, 410, 449},
        {"channeling",         355, 365, 370, 380, 385, 395, 401, 420, 440, 480},
      }, false, "torch (consumed), staff"
    },
  ["Kamikaze Oryctolagus Flammula"]                  = {30, "kof",  "Offensive",     50, 14, 
      {
        {"convoking",           90, 100, 110, 115, 120, 125, 130, 140, 150, 160},
        {"fire",                90, 100, 110, 115, 120, 125, 130, 140, 150, 160},
        {"convoking",          110, 120, 130, 135, 140, 145, 150, 160, 170, 185},
        {"fire",                90, 100, 110, 115, 120, 125, 130, 140, 150, 160},
      }, false, "carrot (consumed), torch"
    },
  ["Kelleflump's Irritating Demon"]                  = {20, "kid",  "Offensive",     30, 13, 
      {
        {"summoning",          120, 125, 130, 135, 140, 145, 150, 160, 165, 175},
        {"cursing",            130, 135, 140, 145, 150, 155, 160, 165, 180, 205},
        {"conjuring",          135, 140, 145, 150, 155, 160, 165, 175, 190, 215},
        {"divining",           120, 125, 130, 135, 140, 145, 150, 160, 170, 180},
      }, false, "knife"
    },
  ["Kipperwald's Perlustration Prevention"]          = {15, "kpp",  "Defensive",     65, 7, 
      {
        {"convoking",          190, 200, 210, 215, 220, 225, 230, 240, 250, 270},
        {"scrying",            210, 220, 230, 240, 250, 255, 260, 270, 280, 290},
        {"divining",           200, 205, 210, 220, 230, 235, 245, 255, 265, 280},
      }, false, "octogram, eye (consumed)"
    },
  ["Malich's AshkEnte Circle"]                       = {10, "mac",  "Miscellaneous", 20, 21, 
      {
        {"channeling",         181, 186, 192, 198, 204, 211, 219, 228, 243, 270},
        {"chanting",           175, 182, 190, 195, 200, 205, 215, 225, 240, 270},
        {"talisman",           100, 106, 114, 130, 140, 152, 160, 170, 180, 190},
        {"staff",              175, 183, 191, 196, 202, 211, 220, 232, 253, 280},
      }, false, "staff (not consumed), phoenix egg, ram skull, candlestick, beeswax candle (all consumed)"
    },
  ["Malich's AshkEnte Summoning Incantation"]        = {60, "masi", "Miscellaneous", 120, 21, 
      {
        {"channeling",         290, 304, 314, 324, 334, 344, 354, 364, 380, 400},
        {"abjuring",           300, 310, 320, 330, 340, 350, 360, 370, 390, 410},
        {"summoning",          320, 330, 340, 350, 360, 370, 380, 395, 405, 435},
      }, false, "charged ashkente circle"
    },
  ["Malich's Penetrating Ocular Lance"]              = {5,  "mpol", "Offensive",     10, 3, 
      {
        {"channeling",          30,  35,  40,  45,  50,  55,  60,  65,  70,  80},
      }, false, "none"
    },
  ["Master Glimer's Amazing Glowing Thing"]          = {30, "mgagt","Miscellaneous", 150, 11, 
      {
        {"evoking",             81,  93,  99, 109, 114, 126, 132, 147, 171, 206},
        {"earth",              126, 135, 140, 145, 153, 165, 171, 189, 216, 252},
        {"chanting",            99, 108, 117, 123, 132, 141, 147, 160, 174, 210},
        {"binding",            147, 153, 162, 168, 177, 183, 193, 205, 230, 270},
        {"enchanting",         203, 208, 219, 225, 234, 243, 248, 270, 291, 325},
      }, false, "octogram, blue funnel (sometimes consumed), handful of pmp (consumed)"
    },
  ["Master Woddeley's Luminescent Companion"]        = {10, "mwlc", "Miscellaneous", 15, 5, 
      {
        {"evoking",             53,  63,  74,  79,  84,  97, 102, 124, 144, 182},
        {"channeling",          82,  92, 100, 106, 113, 123, 131, 149, 170, 202},
        {"animating",          100, 106, 116, 123, 129, 142, 148, 162, 186, 216},
      }, false, "none"
    },
  ["Memories of a Vicious Chicken"]                  = {5,  "mvc",  "Offensive",     10, 3, 
      {
        {"healing",             55,  60,  65,  70,  75,  80,  85,  90, 100, 110},
        {"summoning",           55,  60,  65,  70,  75,  80,  85,  90, 100, 110},
        {"animating",           70,  75,  80,  85,  90,  95, 100, 110, 120, 130},
      }, false, "chicken feather (target receives the feather)"
    },
  ["Mugwuddle's Muddling Mirage"]                    = {25, "mmm",  "Offensive",     55, 5, 
      {
        {"air",                 75,  85,  90, 100, 105, 115, 125, 140, 160, 205},
        {"animating",           95, 105, 110, 120, 130, 140, 145, 160, 185, 220},
        {"summoning",          165, 175, 180, 190, 195, 205, 210, 229, 251, 290},
        {"channeling",         135, 144, 153, 160, 165, 176, 181, 200, 220, 260},
        {"conjuring",          178, 185, 194, 202, 210, 219, 225, 240, 265, 300},
      }, false, "pinch of tobacco (consumed), mirror, pipe"
    },
  ["Myrandil's Mask of Death"]                       = {10, "mmd",  "Miscellaneous", 30, 2, 
      {
        {"enchanting",          81,  88,  98, 105, 112, 121, 128, 147, 169, 200},
        {"healing",             84,  93, 103, 108, 115, 126, 131, 150, 171, 203},
        {"summoning",          107, 115, 123, 130, 136, 147, 152, 171, 192, 220},
        {"binding",            115, 123, 131, 138, 144, 155, 160, 179, 200, 228},
        {"abjuring",           123, 131, 139, 146, 152, 163, 168, 187, 208, 236},
      }, false, "octogram, human head (consumed)"
    },
  ["Myrandil's Vicious Seizure"]                     = {30, "mvs",  "Offensive",     75, 4, 
      {
        {"summoning",          140, 150, 155, 165, 170, 175, 180, 185, 195, 210},
        {"earth",              140, 150, 155, 165, 170, 175, 180, 185, 195, 210},
        {"healing",            180, 190, 195, 200, 210, 220, 230, 240, 250, 265},
        {"animating",          145, 150, 155, 160, 170, 175, 180, 185, 200, 220},
      }, false, "hand (consumed)"
    },
  ["Nargl'frob's Empyrean Spear"]                    = {45, "nes",  "Offensive",     60, 19, 
      {
        {"water",              170, 180, 185, 190, 195, 200, 205, 224, 247, 286},
        {"air",                165, 180, 185, 190, 195, 200, 205, 221, 243, 282},
        {"fire",               165, 180, 185, 190, 195, 200, 205, 219, 240, 278},
        {"earth",              170, 180, 185, 190, 195, 200, 205, 226, 249, 288},
        {"evoking",            170, 175, 180, 185, 190, 195, 200, 227, 250, 288}
      }, false, "torch (consumed)"
    },
  ["Narquin's Hand of Acquisition"]                  = {30, "nha",  "Miscellaneous", 40, 2, 
      {
        {"convoking",          112, 120, 128, 135, 143, 151, 159, 176, 197, 230},
        {"healing",             89,  99, 107, 114, 120, 130, 138, 154, 174, 209},
        {"animating",          122, 130, 140, 147, 152, 163, 170, 188, 209, 243},
      }, false, "hand (consumed)"
    },
  ["Narquin's Mist of Doom"]                         = {15, "nmd",  "Offensive",     30, 4, 
      {
        {"summoning",           95, 100, 110, 115, 120, 125, 135, 145, 155, 165},
        {"healing",            105, 110, 120, 125, 130, 135, 140, 150, 155, 165},
        {"abjuring",            95, 100, 110, 115, 120, 125, 135, 145, 155, 165},
        {"animating",          120, 130, 140, 145, 150, 155, 160, 170, 175, 180},
      }, false, "knife"
    },
  ["Objandeller's Thaumic Funnel"]                   = {15, "otf",  "Miscellaneous", 15, 5, 
      {
        {"water",               77,  85,  95, 102, 108, 120, 125, 142, 165, 195},
        {"channeling",          91, 100, 108, 116, 122, 132, 138, 157, 178, 202},
        {"dancing",             79,  87,  95, 104, 110, 120, 126, 144, 164, 190},
        {"binding",             81,  89,  98, 106, 112, 122, 128, 146, 165, 192},
      }, false, "none"
    },
  ["Old Bellicus' Brazen Knuckles"]                  = {25, "obbk", "Offensive",     50, 17, 
      {
        {"evoking",             92,  99, 108, 115, 120, 129, 139, 152, 170, 200},
        {"binding",             80,  86,  97, 104, 109, 118, 127, 142, 160, 190},
        {"earth",               95, 105, 115, 121, 127, 139, 144, 162, 180, 210},
        {"fire",                59,  68,  77,  83,  92, 104, 109, 127, 145, 180},
        {"binding",             83,  92, 101, 106, 112, 124, 130, 147, 165, 195},
      }, false, "brass ring (consumed)"
    },
  ["Patient Taming of the Quantum Weather Butterfly"]= {50, "ptqwb","Miscellaneous", 85, 8, 
      {
        {"water",              154, 161, 173, 178, 183, 194, 202, 217, 240, 278},
        {"earth",              179, 187, 194, 202, 210, 221, 227, 244, 266, 300},
        {"air",                248, 255, 267, 274, 279, 289, 297, 316, 335, 370},
        {"fire",               250, 257, 269, 276, 281, 291, 299, 318, 337, 372},
        {"binding",            297, 305, 316, 324, 329, 339, 346, 362, 380, 410},
      }, false, "octogram"
    },
  ["Polliwiggle's Puissancy Probe"]                  = {10, "ppp",  "Miscellaneous", 15, 7, 
      {
        {"divining",            32,  40,  50,  57,  63,  73,  79,  98, 119, 160},
        {"divining",            48,  57,  65,  73,  78,  90,  96, 112, 135, 171},
      }, false, "none"
    },
  ["Pragi's Fiery Gaze"]                             = {30, "pfg",  "Offensive",     40, 2, 
      {
        {"evoking",            160, 165, 170, 175, 180, 185, 190, 200, 215, 230},
        {"channeling",         160, 165, 170, 175, 180, 185, 190, 200, 220, 235},
        {"enchanting",         170, 175, 180, 185, 190, 195, 205, 215, 230, 240},
        {"animating",          160, 165, 170, 175, 185, 195, 200, 205, 220, 235},
        {"fire",               185, 190, 195, 200, 205, 210, 215, 225, 240, 255},
      }, false, "eye (consumed)"
    },
  ["Pragi's Lost Gaze"]                              = {30, "plg",  "Offensive",     55, 15, 
      {
        {"evoking",            130, 135, 145, 155, 160, 170, 180, 190, 200, 210},
        {"evoking",            130, 135, 145, 155, 160, 170, 180, 190, 200, 210},
        {"enchanting",         130, 135, 145, 155, 160, 170, 180, 190, 200, 210},
        {"animating",          140, 145, 155, 165, 170, 180, 190, 200, 210, 220},
        {"animating",          140, 145, 155, 165, 170, 180, 190, 200, 210, 220},
        {"fire",               130, 135, 145, 155, 160, 170, 180, 190, 200, 210},
      }, false, "hand, left leg, right leg, eye (all consumed)"
    },
  ["Pragi's Molten Gaze"]                            = {10, "pmg",  "Miscellaneous", 20, 3, 
      {
        {"animating",          100, 105, 110, 115, 120, 125, 130, 135, 145, 165},
        {"fire",               115, 120, 125, 135, 140, 150, 155, 165, 178, 199},
        {"evoking",             90,  95, 100, 105, 110, 115, 125, 135, 145, 165},
        {"channeling",         110, 115, 120, 130, 135, 145, 150, 160, 175, 195},
      }, false, "shimmering glass nugget"
    },
  ["Professor Flambardie's Grim Amulet"]             = {50, "pfga", "Miscellaneous", 200, 13, 
      {
        {"amulet",             130, 135, 140, 145, 150, 155, 165, 180, 200, 240},
        {"water",              200, 210, 220, 225, 230, 240, 250, 265, 280, 305},
        {"wand",               195, 205, 215, 220, 225, 235, 245, 260, 275, 300},
        {"summoning",          225, 230, 240, 245, 250, 260, 270, 285, 300, 350},
        {"binding",            220, 230, 240, 250, 260, 270, 280, 290, 305, 355},
      }, false, "wand, silver medallion (consumed), small green crystal (consumed)"
    },
  ["Reckless Encouragement of Arcane Peacock"]       = {20, "reap", "Offensive",     65, 6, 
      {
        {"air",                200, 206, 216, 225, 230, 241, 246, 264, 287, 320},
        {"channeling",         225, 235, 243, 250, 257, 267, 273, 290, 310, 340},
        {"divining",           275, 284, 293, 302, 307, 316, 325, 340, 360, 390},
        {"binding",            250, 260, 268, 273, 282, 293, 299, 316, 339, 360},
        {"enchanting",         270, 281, 290, 300, 305, 313, 320, 336, 350, 380},
      }, false, "tigerwood staff"
    },
  ["Rubayak's Power Dispenser"]                      = {5,  "rpd",  "Miscellaneous", 20, 18, 
      {
        {"enchanting",          70,  80,  90,  95, 100, 105, 115, 125, 140, 170},
        {"channeling",          70,  80,  90,  95, 100, 105, 115, 125, 140, 170},
        {"binding",             70,  80,  90,  95, 100, 105, 115, 125, 140, 170},
      }, false, "wooden monkey, small red crystal (consumed), banana (consumed)"
    },
  ["Rubayak's Power Storage"]                        = {30, "rps",  "Miscellaneous", 40, 11, 
      {
        {"binding",             64,  74,  83,  89,  95, 108, 115, 130, 152, 189},
        {"channeling",         161, 167, 177, 183, 189, 202, 208, 224, 240, 273},
        {"enchanting",          92, 102, 111, 118, 124, 136, 142, 158, 180, 200},
        {"enchanting",         152, 161, 167, 177, 183, 193, 199, 216, 239, 270},
      }, false, "black shell"
    },
  ["Rugged Victor's Rodentia Vivisection"]           = {10, "rvrv", "Offensive",     15, 3, 
      {
        {"charming",            59,  64,  71,  77,  83,  89,  95, 100, 112, 125},
        {"dancing",             50,  55,  60,  65,  70,  75,  80,  85,  90, 100},
      }, false, "rat tail"
    },
  ["Sageroff's Sentry Summoning"]                    = {30, "sss2", "Defensive",     35, 13, 
      {
        {"fire",               111, 122, 131, 136, 142, 153, 159, 175, 201, 237},
        {"charming",           114, 125, 134, 139, 142, 156, 162, 178, 204, 240},
        {"summoning",          131, 139, 147, 156, 161, 170, 178, 197, 217, 252},
        {"abjuring",            91,  97, 105, 114, 120, 130, 170, 180, 190, 212},
        {"banishing",          144, 153, 164, 170, 175, 187, 192, 209, 234, 268},
      }, false, "octogram, candle (lit), knife, mirror, apple (consumed)"
    },
  ["Scolorid's Scintillating Scribbling"]            = {10, "sss",  "Miscellaneous", 10, 3, 
      {
        {"evoking",             80,  90, 100, 110, 120, 130, 140, 150, 160, 170},
        {"binding",             85,  95, 105, 115, 125, 135, 145, 155, 165, 175},
        {"convoking",           90, 100, 110, 120, 130, 140, 150, 160, 170, 180},
        {"enchanting",         100, 110, 120, 130, 140, 150, 160, 170, 180, 190},
      }, false, "none"
    },
  ["Skeetbraskin's Fuliginous Perdition"]            = {20, "sfp2", "Offensive",     20, 13, 
      {
        {"summoning",          119, 125, 134, 139, 146, 155, 164, 182, 203, 236},
        {"abjuring",           203, 208, 218, 224, 233, 242, 248, 266, 287, 320},
        {"banishing",          182, 197, 203, 209, 215, 224, 233, 251, 272, 308},
        {"conjuring",          175, 180, 185, 191, 196, 209, 214, 230, 250, 293},
      }, false, "none"
    },
  ["Sorklin's Field of Protection"]                  = {10, "sfp",  "Defensive",     15, 3, 
      {
        {"evoking",             60,  65,  70,  75,  80,  85,  90,  95, 100, 110},
        {"air",                 50,  55,  60,  65,  70,  75,  80,  85,  90, 100},
        {"channeling",          70,  75,  80,  85,  90,  95, 100, 105, 110, 120},
      }, false, "shield"
    },
  ["Sorsalsean's Seismic Eruption"]                  = {40, "sse",  "Offensive",     50, 17, 
      {
        {"earth",              176, 183, 192, 198, 204, 215, 221, 233, 256, 285},
        {"evoking",            170, 180, 189, 195, 202, 211, 219, 230, 250, 280},
        {"chanting",           176, 183, 192, 198, 204, 215, 221, 233, 256, 285},
        {"channeling",         170, 180, 189, 195, 202, 211, 219, 230, 250, 280},
        {"dancing",            150, 159, 160, 176, 181, 192, 198, 215, 235, 250},
      }, false, "pebble (consumed)"
    },
  ["Stacklady's Morphic Resonator"]                  = {40, "smr",  "Offensive",     60, 20, 
      {
        {"channeling",         280, 290, 303, 308, 316, 326, 331, 345, 365, 390},
        {"evoking",            224, 233, 241, 250, 255, 264, 270, 290, 300, 340},
        {"enchanting",         240, 250, 260, 265, 270, 284, 290, 300, 326, 364},
      }, false, "pinch of powdered frog, pinch of pmp (all consumed)"
    },
  ["Thousand Dancing Celestial Fates"]               = {20, "tdcf", "Miscellaneous", 50, 1, 
      {
        {"dancing",            120, 130, 140, 145, 150, 155, 160, 165, 170, 180},
        {"turning",            120, 130, 140, 145, 150, 155, 160, 165, 170, 180},
        {"whittling",          120, 130, 140, 145, 150, 155, 160, 165, 170, 180},
        {"enchanting",         140, 150, 160, 165, 170, 175, 180, 185, 190, 200},
        {"binding",            140, 150, 160, 165, 170, 175, 180, 185, 190, 200}
      }, false, "octogram, staff, octiron sliver (consumed)"
    },
  ["Torqvald's Illusion Generatrix"]                 = {50, "tig",  "Miscellaneous", 100, 5, 
      {
        {"air",                188, 196, 206, 212, 217, 227, 236, 252, 271, 300},
        {"binding",            196, 206, 212, 220, 225, 236, 241, 260, 280, 312},
        {"conjuring",          190, 197, 206, 215, 220, 230, 236, 254, 274, 307},
        {"charming",           170, 179, 187, 196, 201, 211, 217, 236, 257, 290},
        {"channeling",         203, 211, 223, 227, 233, 244, 252, 268, 288, 318},
        {"conjuring",          185, 193, 203, 209, 217, 227, 233, 252, 270, 298},
        {"charming",           233, 241, 250, 257, 263, 274, 279, 298, 317, 346},
      }, false, "small bucket, quill (consumed), book end (consumed), silver ring (consumed)"
    },
  ["Torqvald's Many Colours"]                        = {10, "tmc",  "Miscellaneous", 15, 3, 
      {
        {"air",                 50,  60,  70,  75,  80,  85,  90, 100, 110, 120},
        {"channeling",          60,  70,  80,  90, 100, 105, 110, 120, 130, 140},
        {"charming",            70,  80,  90, 100, 105, 110, 115, 125, 135, 145},
      }, false, "none"
    },
  ["Transcendent Pneumatic Alleviator"]              = {25, "tpa",  "Defensive",     45, 12, 
      {
        {"evoking",             90,  95, 100, 105, 110, 120, 130, 140, 150, 165},
        {"air",                105, 110, 120, 125, 130, 140, 145, 150, 160, 175},
        {"chanting",           105, 110, 120, 125, 130, 140, 150, 160, 170, 185},
        {"enchanting",         105, 110, 120, 125, 130, 140, 150, 160, 170, 180},
        {"channeling",         140, 145, 150, 155, 160, 170, 180, 185, 200, 210},
      }, false, "shield, handful of fine ash (consumed) - grey, black or white ash"
    },
  ["Turnwhistle's Effulgent Autiridescence"]         = {10, "tea",  "Miscellaneous", 150, 10, 
      {
        {"divining",           138, 143, 150, 155, 160, 165, 175, 185, 195, 210},
        {"convoking",          176, 194, 203, 214, 220, 225, 230, 240, 250, 270},
        {"evoking",            200, 210, 215, 220, 225, 235, 245, 255, 265, 280},
        {"binding",            200, 210, 215, 220, 225, 235, 245, 255, 265, 280},
      }, false, "octogram, shimmering glass nugget, lantern (consumed)"
    },
  ["Union of the Phoenix and Divine Dragon"]         = {25, "updd", "Miscellaneous", 50, 9, 
      {
        {"channeling",         145, 150, 160, 165, 170, 180, 185, 195, 205, 215},
        {"summoning",          150, 160, 170, 175, 180, 185, 195, 205, 215, 235},
        {"charming",           180, 185, 195, 200, 205, 215, 225, 235, 245, 255},
      }, false, "shimmering glass nugget"
    },
  ["Von Hasselhoff's Skin Condition"]                = {35, "vhsc", "Offensive",     65, 4, 
      {
        {"convoking",          160, 166, 175, 183, 190, 199, 205, 225, 240, 270},
        {"healing",            144, 150, 159, 166, 172, 185, 190, 208, 230, 260},
        {"charming",           125, 134, 141, 148, 155, 167, 172, 187, 200, 245},
        {"binding",            160, 166, 175, 183, 190, 199, 205, 225, 240, 270},
      }, false, "human skin (consumed) - can use tanner's kit to divide skins first"
    },
  ["Wonker's Wicked Wobble"]                         = {45, "www",  "Offensive",     40, 10, 
      {
        {"gold",               260, 270, 280, 290, 300, 310, 320, 330, 340, 350},
        {"binding",            160, 165, 170, 175, 185, 200, 215, 230, 245, 260},
        {"rod",                170, 175, 185, 190, 200, 205, 215, 225, 235, 250},
        {"enchanting",         170, 175, 185, 190, 200, 205, 215, 225, 235, 250},
      }, false, "rubber knife"
    },
  ["Worstler's Advanced Metallurgical Glance"]       = {15, "wamg", "Miscellaneous", 20, 7, 
      {
        {"animating",            9,  17,  24,  33,  38,  50,  56,  74,  95, 133},
        {"divining",            50,  58,  66,  73,  79,  90,  98, 115, 135, 169},
        {"scrying",             57,  65,  73,  80,  86,  97, 105, 122, 142, 176},
      }, false, "blorped jewellery"
    },
  ["Worstler's Elementary Mineralogical Glance"]     = {5,  "wemg", "Miscellaneous", 10, 3, 
      {
        {"earth",               30,  35,  40,  45,  50,  55,  60,  70,  80,  90},
        {"evoking",             40,  45,  50,  55,  60,  65,  70,  80,  90, 100},
        {"scrying",             70,  80,  90,  95, 100, 105, 110, 115, 125, 135},
      }, false, "blorped rock"
    },
  ["Wungle's Body Part Suggestion"]                  = {30, "wbps", "Offensive",     25, 4, 
      {
        {"summoning",           40,  49,  52,  65,  71,  83,  89, 106, 130, 170},
        {"healing",             32,  40,  50,  55,  61,  74,  80,  98, 119, 158},
        {"animating",          122, 129, 136, 144, 150, 162, 169, 186, 200, 230},
        {"binding",             71,  80,  89,  96, 101, 113, 119, 136, 158, 190},
      }, false, "knife (consumed)"
    },
  ["Wungle's Great Sucking"]                         = {35, "wgs",  "Offensive",     50, 4, 
      {
        {"summoning",          170, 175, 180, 190, 200, 205, 210, 220, 230, 250},
        {"chanting",           170, 175, 180, 190, 200, 205, 210, 220, 230, 250},
        {"healing",            170, 180, 190, 200, 205, 210, 220, 230, 240, 260},
        {"cursing",            185, 195, 200, 210, 220, 225, 235, 244, 255, 270},
      }, false, "human heart (consumed)"
    },
  ["Wurphle's Midnight Snack"]                       = {25, "wms",  "Miscellaneous", 35, 16, 
      {
        {"channeling",         102, 110, 121, 127, 133, 144, 150, 169, 189, 221},
        {"evoking",            119, 125, 135, 141, 148, 158, 165, 183, 202, 238},
        {"convoking",          119, 127, 135, 144, 150, 160, 167, 183, 204, 238},
      }, false, "none"
    },
  ["Wurphle's Packed Lunch"]                       = {10, "wpl",  "Miscellaneous", 300, 16, 
      {
        {"animating",         256, 259, 263, 268, 274, 280, 286, 303, 315, 355},
        {"enchanting",        304, 310, 313, 319, 324, 331, 334, 347, 359, 388},
        {"whittling",         355, 360, 363, 370, 373, 378, 385, 395, 411, 434}, 
        {"binding",           304, 310, 313, 319, 324, 331, 336, 347, 359, 388},
      }, false, "octogram, sapient pearwood seed, hubland bear fur, wood riving, large rhokshial crystal, threaded needle, knife (only knife and needle not consumed)"
    },
  ["Yordon's Extremal Extension"]                    = {35, "yee",  "Miscellaneous", 70, 20, 
      {
        {"channeling",          71,  78,  88,  95, 103, 111, 118, 135, 157, 195},
        {"convoking",           76,  85,  93, 100, 106, 116, 123, 140, 162, 199},
        {"evoking",             79,  88,  95, 102, 109, 118, 125, 142, 165, 202},
        {"binding",             95, 102, 111, 118, 123, 135, 140, 159, 181, 215},
        {"animating",          111, 118, 128, 135, 140, 152, 157, 175, 197, 230},
      }, false, "dwarf arm, human arm, troll arm (all consumed), octogram"
    },
  -- Witch spells!
  ["Banishing of Loquacious Spirits"]                = {5,  "bls",  "Miscellaneous", 20, 0, 
      {
        {"scrying",             52,  55,  61,  68,  72,  79,  86, 101, 125, 154},
        {"abjuring",           152, 155, 161, 168, 172, 179, 186, 201, 225, 254},
        {"banishing",          152, 155, 161, 168, 172, 179, 186, 201, 225, 254},
      }, true, "none"
    },
  ["Banishing of Prying Eyes"]                       = {5,  "bpe",  "Defensive",     25, 0, 
      {
        {"air",                122, 125, 131, 138, 142, 149, 156, 171, 195, 224},
        {"banishing",          122, 125, 131, 138, 142, 149, 156, 171, 195, 224},
        {"abjuring",           122, 125, 131, 138, 142, 149, 156, 171, 195, 224},
      }, true, "none"
    },
  ["Banishing of Unnatural Urges"]                   = {5,  "buu",  "Defensive",     25, 0, 
      {
        {"conjuring",          122, 125, 131, 138, 142, 149, 156, 171, 195, 224},
        {"fire",               122, 125, 131, 138, 142, 149, 156, 171, 195, 224},
        {"banishing",          122, 125, 131, 138, 142, 149, 156, 171, 195, 224},
      }, true, "none"
    },
  ["Biddy Amble's Bee Buzzer"]                       = {60, "babb", "Miscellaneous", 200, 0, 
      {
        {"charming",           202, 205, 211, 218, 222, 229, 236, 251, 275, 304},
        {"dancing",            182, 185, 191, 198, 202, 209, 216, 231, 255, 284},
        {"chanting",           182, 185, 191, 198, 202, 209, 216, 231, 255, 284},
        {"herbal",              62,  65,  71,  78,  82,  89,  96, 111, 135, 164},
      }, true, "none"
    },
  ["Delusions of Grandeur"]                          = {50, "dog",  "Miscellaneous", 100, 0, 
      {
        {"divining",           152, 155, 161, 168, 172, 179, 186, 201, 225, 254},
        {"convoking",          202, 205, 211, 218, 222, 229, 236, 251, 275, 304},
        {"enchanting",         252, 255, 261, 268, 272, 279, 286, 301, 325, 354},
      }, true, "none"
    },
  ["Gammer Shorga's Clever Creeper"]                 = {20, "gscc", "Miscellaneous", 70, 0, 
      {
        {"charming",           277, 280, 286, 293, 297, 304, 311, 326, 350, 379},
        {"shaping",            152, 155, 161, 168, 172, 179, 186, 201, 225, 254},
        {"ring",               202, 205, 211, 218, 222, 229, 236, 251, 275, 304},
        {"animating",          202, 205, 211, 218, 222, 229, 236, 251, 275, 304},
      }, true, "piece of clay (consumed), smelly seed (consumed)"
    },
  ["Gammer Shorga's Helpful Undergrowth"]            = {25, "gshu", "Offensive",     70, 0, 
      {
        {"animating",          102, 105, 111, 118, 122, 129, 136, 151, 175, 204},
        {"cursing",            152, 155, 161, 168, 172, 179, 186, 201, 225, 254},
      }, true, "smelly seed (consumed)"
    },
  ["Gammer Tumult's Amalgamator"]                    = {20, "gta",  "Miscellaneous", 45, 0, 
      {
        {"evoking",            152, 155, 161, 168, 172, 179, 186, 201, 225, 254},
        {"weaving",             52,  55,  61,  68,  72,  79,  86, 101, 125, 154},
        {"binding",            192, 195, 201, 208, 212, 219, 226, 241, 265, 294},
      }, true, "none"
    },
  ["Goodie Whemper's Apple Divination"]              = {20, "gwad", "Miscellaneous", 40, 0, 
      {
        {"channeling",         102, 105, 111, 118, 122, 129, 136, 151, 175, 204},
        {"divining",            77,  80,  86,  93,  97, 104, 111, 126, 150, 179},
      }, true, "knife, apple (unpeeled, peel consumed)"
    },
  ["Grammer Scorbic's Household Guard"]              = {20, "gshg", "Defensive",     50, 0, 
      {
        {"evoking",             62,  65,  71,  78,  82,  89,  96, 111, 135, 164},
        {"channeling",         122, 125, 131, 138, 142, 149, 156, 171, 195, 224},
        {"binding",            177, 180, 186, 193, 197, 204, 211, 226, 250, 279},
      }, true, "utensil (to float)"
    },
  ["Granny Beedle's Cooperative Credits"]            = {40, "gbcc", "Miscellaneous", 60, 0, 
      {
        {"talisman",            82,  85,  91,  98, 102, 109, 116, 131, 155, 184},
        {"chanting",           112, 115, 121, 128, 132, 139, 146, 161, 185, 214},
        {"scrying",            172, 175, 181, 188, 192, 199, 206, 221, 245, 274},
        {"divining",           162, 165, 171, 178, 182, 189, 196, 211, 235, 264},
      }, true, "quill, paper (both optional)"
    },
  ["Granny Benedict's Bond of Loyalty"]              = {50, "gbbl", "Miscellaneous", 80, 0, 
      {
        {"talisman",            62,  65,  71,  78,  82,  89,  96, 111, 135, 164},
        {"summoning",          102, 105, 111, 118, 122, 129, 136, 151, 175, 204},
        {"charming",           152, 155, 161, 168, 172, 179, 186, 201, 225, 254},
        {"binding",            127, 130, 136, 143, 147, 154, 161, 176, 200, 229},
      }, true, "none"
    },
  ["Granny Lipintense's Layer of Lard"]              = {15, "glll", "Miscellaneous", 40, 0, 
      {
        {"dancing",            117, 120, 126, 133, 137, 144, 151, 166, 190, 219},
        {"charming",           112, 115, 121, 128, 132, 139, 146, 161, 185, 214},
        {"channeling",         147, 150, 156, 163, 167, 174, 181, 196, 220, 249},
      }, true, "eel skin, duck feather (consumed)"
    },
  ["Hag's Blessing"]                                 = {10, "hb",   "Miscellaneous", 25, 0, 
      {
        {"divining",            77,  80,  86,  93,  97, 104, 111, 126, 150, 179},
        {"charming",           102, 105, 111, 118, 122, 129, 136, 151, 175, 204},
        {"summoning",          102, 105, 111, 118, 122, 129, 136, 151, 175, 204},
      }, true, "none"
    },
  ["Mama Blackwing's Potent Preserver"]              = {20, "mbpp", "Miscellaneous", 40, 0, 
      {
        {"fire",               152, 155, 161, 168, 172, 179, 186, 201, 225, 254},
        {"chanting",           127, 130, 136, 143, 147, 154, 161, 176, 200, 229},
        {"channeling",         202, 205, 211, 218, 222, 229, 236, 251, 275, 304},
        {"water",              147, 150, 156, 163, 167, 174, 181, 196, 220, 249},
      }, true, "", "frog, candle"
    },
  ["Mama Kolydina's Instant Infestation"]            = {45, "mkii", "Defensive",     70, 0, 
      {
        {"summoning",          122, 125, 131, 138, 142, 149, 156, 171, 195, 224},
        {"charming",            92,  95, 101, 108, 112, 119, 126, 141, 165, 194},
        {"chanting",           112, 115, 121, 128, 132, 139, 146, 161, 185, 214},
        {"binding",            102, 105, 111, 118, 122, 129, 136, 151, 175, 204},
        {"cursing",             87,  90,  96, 103, 107, 114, 121, 136, 160, 189},
      }, true, "sugar cube/sugar lump (consumed)"
    },
  ["Mother Brynda's Call of Gravity"]                = {20, "mbcg", "Offensive",     50, 0, 
      {
        {"evoking",             62,  65,  71,  78,  82,  89,  96, 111, 135, 164},
        {"channeling",         122, 125, 131, 138, 142, 149, 156, 171, 195, 224},
        {"binding",            177, 180, 186, 193, 197, 204, 211, 226, 250, 279},
      }, true, "willow withe"
    },
  ["Mother Feelbright's Busy Bees"]                  = {60, "mfbb", "Offensive",     60, 0, 
      {
        {"channeling",         142, 145, 151, 158, 162, 169, 176, 191, 215, 244},
        {"summoning",          177, 180, 186, 193, 197, 204, 211, 226, 250, 279},
        {"cursing",            107, 110, 116, 123, 127, 134, 141, 156, 180, 209},
        {"charming",           197, 200, 206, 213, 217, 224, 231, 246, 270, 299},
      }, true, "honey (consumed)"
    },
  ["Mother Harblist's Fruity Flyer"]                 = {60, "mhff", "Miscellaneous", 200, 0, 
      {
        {"summoning",          202, 205, 211, 218, 222, 229, 236, 251, 275, 304},
        {"chanting",           252, 255, 261, 268, 272, 279, 286, 301, 325, 354},
        {"charming",           202, 205, 211, 218, 222, 229, 236, 251, 275, 304},
        {"dancing",            272, 275, 281, 288, 292, 299, 306, 321, 345, 374},
      }, true, "apple (consumed)"
    },
  ["Mother Twinter's Yarrow Enchantment"]            = {10,  "mtye", "Miscellaneous", 50, 0, 
      {
        {"evoking",             27,  30,  36,  43,  47,  54,  61,  76, 100, 129},
        {"enchanting",          52,  55,  61,  68,  72,  79,  86, 101, 125, 154},
        {"chanting",            52,  55,  61,  68,  72,  79,  86, 101, 125, 154},
        {"enchanting",         102, 105, 111, 118, 122, 129, 136, 151, 175, 204},
      }, true, "yarrow (consumed)"
    },
  ["Nanny Revere's Traitorous Talisman"]             = {50, "nrtt", "Miscellaneous", 80, 0, 
      {
        {"talisman",           102, 105, 111, 118, 122, 129, 136, 151, 175, 204},
        {"divining",           152, 155, 161, 168, 172, 179, 186, 201, 225, 254},
        {"chanting",           252, 255, 261, 268, 272, 279, 286, 301, 325, 354},
        {"charming",           302, 305, 311, 318, 322, 329, 336, 351, 375, 404},
      }, true, "none"
    },
  ["Wee Flaudia's Fluffy Ear Muffs"]                 = {10, "wffem","Defensive",     30, 0, 
      {
        {"chanting",           102, 105, 111, 118, 122, 129, 136, 151, 175, 204},
        {"channeling",         112, 115, 121, 128, 132, 139, 146, 161, 185, 214},
        {"air",                132, 135, 141, 148, 152, 159, 166, 181, 205, 234},
      }, true, "none"
    },
  -- 2024 - Hedge guild new spells
  ["Feyfirkin's Errant Trainee Collection Herbage"]  = {25, "fetch",  "Miscellaneous", 200, 23, 
      {
                            --10   20   30   40   50   60   70   80   90  100
        {"divining",         285, 289, 293, 298, 302, 310, 315, 325, 340, 375},
        {"staff",            230, 234, 239, 245, 247, 255, 260, 270, 288, 309},
        {"convoking",        274, 279, 284, 289, 294, 300, 306, 315, 333, 353},
        {"channeling",       219, 223, 228, 233, 238, 243, 249, 260, 280, 300},
        {"evoking",          238, 243, 248, 254, 258, 264, 269, 279, 294, 318},
      }, false, "wooden staff (not consumed)"
    },
  ["Luquayle's Longevity-Enhancing Ballast"]         = {35, "lleb",  "Miscellaneous", 150, 23, 
      {
                            --10   20   30   40   50   60   70   80   90  100
        {"gold",             250, 254, 258, 264, 269, 275, 281, 291, 306, 329},
        {"turning",          214, 218, 223, 228, 233, 239, 245, 255, 270, 293},
        {"enchanting",       195, 200, 204, 208, 213, 218, 225, 235, 250, 275},
        {"water",            178, 182, 187, 193, 200, 204, 209, 219, 235, 261},
        {"binding",          214, 218, 223, 228, 233, 239, 245, 255, 270, 292},
      }, false, "sliver of octiron (consumed), ironwood riving (consumed)"
    },
  ["Ridcully's Travelling Furniture Manufactory"]    = {10, "rtfm",  "Miscellaneous", 50, 23, 
      {
        {"chanting",         104, 109, 114, 119, 122, 129, 136, 145, 159, 180},
        {"dancing",          104, 109, 114, 119, 122, 129, 136, 145, 159, 180},
        {"conjuring",        104, 109, 114, 119, 122, 129, 136, 145, 159, 180},
        {"banishing",        104, 109, 114, 119, 122, 129, 136, 145, 159, 180},
        {"charming",         104, 109, 114, 119, 122, 129, 136, 145, 159, 180},
      }, false, "none"
    },
  ["Ralstorphine's Refreshing Draught"]              = {5, "rrd",  "Miscellaneous", 25, 23, 
      {
        {"water",             54,  58,  63,  68,  72,  78,  83,  94, 109, 135},
        {"evoking",           80,  84,  89,  93,  97, 104, 109, 121, 134, 155},
        {"summoning",         54,  58,  63,  68,  72,  78,  83,  94, 109, 135},
      }, false, "none"
    },
}

-- Reverse acronym to full spellname
sAcronymToSpell = {}
for sKey, iValue in pairs (objQuowSpellData) do
  sAcronymToSpell[iValue[2]] = sKey
end
-- Secondary acronyms to same spells
sAcronymToSpell["boa1"] = "Brassica Oleracea Ambulata"
sAcronymToSpell["dog1"] = "Delusions of Grandeur"
sAcronymToSpell["kid1"] = "Kelleflump's Irritating Demon"
sAcronymToSpell["reap1"] = "Reckless Encouragement of Arcane Peacock"
sAcronymToSpell["tea1"] = "Turnwhistle's Effulgent Autiridescence"
sAcronymToSpell["fae1"] = "Fiddelmaker's Auriferous Embrace"
sAcronymToSpell["fetch1"] = "Feyfirkin's Errant Trainee Collection Herbage"
sAcronymToSpell["quow"] = "Luquayle's Longevity-Enhancing Ballast"
sAcronymToSpell["rtfm1"] = "Ridcully's Travelling Furniture Manufactory"

sTypeShort = {
  ["Defensive"] = "def",
  ["Offensive"] = "off",
  ["Miscellaneous"] = "misc",
}

-- Json decode required for skills background handling, spell/mindspace per-alt storage system, and more
require "json"

-- Special screenreader mode, for more reader-friendly output formats etc.
bScreenreaderMode = false
if (GetVariable("bMindspaceReader") == "true") then
  bScreenreaderMode = true
end

-- See if we can find out who we are from the CowBar since we won't know who we are on plugin-launch
sCurrentCharacter = ""
if (PluginSupports("bfe35205f026786ea1d56e3b", "CheckCharacterName") == 0) then
  iReturnCode, sCurrentCharacter = CallPlugin ("bfe35205f026786ea1d56e3b", "CheckCharacterName", "")
  sCurrentCharacter = string.lower(sCurrentCharacter)
end
if (sCurrentCharacter == nil or sCurrentCharacter == "") then
  -- We still aren't sure who this is, maybe try load our previously-loaded name, then?
  local sPossibleName = GetVariable("sCurChar")
  if (sPossibleName ~= nil and sPossibleName ~= "") then
    sCurrentCharacter = sPossibleName
    sPossibleName = nil
  else
    -- Final fallback, call ourselves "NoName"
    sCurrentCharacter = "NoName"
  end
end
-- And quickly save to file who we are, for plugin reloads after this
SetVariable("sCurChar", sCurrentCharacter)

-- See if we can find out our guild/order from the CowBar
sCurrentGuild, sCurrentSpec = "", ""
if (PluginSupports("bfe35205f026786ea1d56e3b", "CheckGuildSpec") == 0) then
  iReturnCode, sCurrentGuild, sCurrentSpec = CallPlugin ("bfe35205f026786ea1d56e3b", "CheckGuildSpec", "")
  sCurrentGuild = string.lower(sCurrentGuild)
  sCurrentSpec = string.lower(sCurrentSpec)
end

-- In case the CowBar wasn't loaded before this plugin was, let the CowBar prepare us...
function UpdateMySupports()
  if (PluginSupports("bfe35205f026786ea1d56e3b", "CheckCharacterName") == 0) then
    iReturnCode, sCurrentCharacter = CallPlugin ("bfe35205f026786ea1d56e3b", "CheckCharacterName", "")
    sCurrentCharacter = string.lower(sCurrentCharacter)
  end
  if (sCurrentCharacter == nil or sCurrentCharacter == "") then
    -- We still aren't sure who this is, maybe try load our previously-loaded name, then?
    local sPossibleName = GetVariable("sCurChar")
    if (sPossibleName ~= nil and sPossibleName ~= "") then
      sCurrentCharacter = sPossibleName
      sPossibleName = nil
    else
      -- Final fallback, call ourselves "NoName"
      sCurrentCharacter = "NoName"
    end
  end
  -- And quickly save to file who we are, for plugin reloads after this
  SetVariable("sCurChar", sCurrentCharacter)
  -- See if we can find out our guild/order from the CowBar
  sCurrentGuild, sCurrentSpec = "", ""
  if (PluginSupports("bfe35205f026786ea1d56e3b", "CheckGuildSpec") == 0) then
    iReturnCode, sCurrentGuild, sCurrentSpec = CallPlugin ("bfe35205f026786ea1d56e3b", "CheckGuildSpec", "")
    sCurrentGuild = string.lower(sCurrentGuild)
    sCurrentSpec = string.lower(sCurrentSpec)
  end
end

-- Load in pre-saved mindspaces
iMindspaceSpecialPerAlt = GetVariable("SpecialPerAlt")
if (iMindspaceSpecialPerAlt ~= nil) then
  iMindspaceSpecialPerAlt = json.decode(iMindspaceSpecialPerAlt)
else
  ColourNote("yellow", "", "Quow's Mindspace & Spellcheck Plugin:")
  ColourNote("darkorange", "",     "=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=")
  ColourNote("silver", "", "When logged in, use the command 'mindspace skills' to allow Quow's mindspace plugin to see your skills.")
  ColourNote("silver", "", "You can check the full range of commands and features by using the command 'mindspace help'")
  ColourNote("silver", "", "(you should only see this message on a first install of the mindspace plugin)")
  iMindspaceSpecialPerAlt = {
    [sCurrentCharacter] = 0,
  }
  SetVariable("SpecialPerAlt", json.encode(iMindspaceSpecialPerAlt))
end

-- Load in pre-saved skills
objMindspaceSkillsPerAlt = GetVariable("SkillsPerAlt")
if (objMindspaceSkillsPerAlt ~= nil) then
  objMindspaceSkillsPerAlt = json.decode(objMindspaceSkillsPerAlt)
else
  objMindspaceSkillsPerAlt = {
    [sCurrentCharacter] = {},
  }
end
-- Look for missing skills (eg if we have a new method-check added in the future) - and ensure integers not strings for skills
for sSkillName, sSkillData in pairs(sQuowSkillTree) do
  for sCharName, objSkillList in pairs (objMindspaceSkillsPerAlt) do
    if (objMindspaceSkillsPerAlt[sCharName][sSkillName] == nil) then
      objMindspaceSkillsPerAlt[sCharName][sSkillName] = 0
    else
      objMindspaceSkillsPerAlt[sCharName][sSkillName] = tonumber(objMindspaceSkillsPerAlt[sCharName][sSkillName])
    end
  end
end


-- Load in known-spells
objSpellsKnownPerAlt = GetVariable("SpellsPerAlt")
if (objSpellsKnownPerAlt ~= nil) then
  objSpellsKnownPerAlt = json.decode(objSpellsKnownPerAlt)
else
  objSpellsKnownPerAlt = {
    [sCurrentCharacter] = {},
  }
end

-- Load in pre-saved stat/info on spellcasts etc.
objSpellInfoPerAlt = GetVariable("SpinfoPerAlt")
if (objSpellInfoPerAlt ~= nil) then
  objSpellInfoPerAlt = json.decode(objSpellInfoPerAlt)
else
  objSpellInfoPerAlt = {
    [sCurrentCharacter] = {},
  }
end

-- Check for missing skills in our arrays for this character name
function CheckMissingSkills(sCheckThisChar)
  -- Mindspace special value
  if (iMindspaceSpecialPerAlt[sCheckThisChar] == nil) then
    iMindspaceSpecialPerAlt[sCheckThisChar] = 0
  end
  -- Skill bonuses per-skill
  if (objMindspaceSkillsPerAlt[sCheckThisChar] == nil) then
    objMindspaceSkillsPerAlt[sCheckThisChar] = {}
    for sSkillName, sSkillData in pairs(sQuowSkillTree) do
      objMindspaceSkillsPerAlt[sCheckThisChar][sSkillName] = 0
    end
  end
  -- Spells known
  if (objSpellsKnownPerAlt[sCheckThisChar] == nil) then
    objSpellsKnownPerAlt[sCheckThisChar] = {}
  end
  -- Spell stats
  if (objSpellInfoPerAlt[sCheckThisChar] == nil) then
    objSpellInfoPerAlt[sCheckThisChar] = {}
  end
end

-- Finally, see if we need to set up arrays/variables for this character name before we start with the plugin functions
CheckMissingSkills(sCurrentCharacter)

-- This function is actually only ever called by modern CowBar versions, to alert us of a detected alt-switch
function CharacterSwitch(sThisCharacterName)
  sCurrentCharacter = string.lower(sThisCharacterName)
  -- Safety fallback in case the CowBar failed to get our name from the MUD
  if (sCurrentCharacter == nil or sCurrentCharacter == "") then
    local sPossibleName = GetVariable("sCurChar")
    if (sPossibleName ~= nil and sPossibleName ~= "") then
      -- Let's just assume we are who we were last time... hoofies crossed!
      sCurrentCharacter = sPossibleName
      sPossibleName = nil
    else
      -- Final fallback, call ourselves "NoName"
      sCurrentCharacter = "NoName"
    end
  end
  CheckMissingSkills(sCurrentCharacter)
  -- And quickly save to file who we are, for plugin reloads after this
  SetVariable("sCurChar", sCurrentCharacter)
end

-- This function is only ever called by modern CowBar versions, to tell us our guild/order
function GuildSwitch(sThisGuild, sThisSpec)
  sCurrentGuild = string.lower(sThisGuild)
  sCurrentSpec = string.lower(sThisSpec)
end

-- Comma-separate long numbers
function NumberCommaString(iQuantity)
  local sFormatted = iQuantity
  while true do  
    sFormatted, iK = string.gsub(sFormatted, "^(-?%d+)(%d%d%d)", '%1,%2')
    if (iK == 0) then
      break
    end
  end
  return sFormatted
end

iQuowTotalMS = 0
iQuowDefMS = 0
iQuowOffMS = 0
iQuowMiscMS = 0
iQuowSpells = 0
iQuowDefSpells = 0
iQuowOffSpells = 0
iQuowMiscSpells = 0
iQuowMSProcess = 0
iQuowNeed = 0
iQuowDone = 0
iQuowCatSeen = 0
objSpellsSeen = {}
iGotStats = 0
bWaitingForUpdate = false
bNeedingBGStats = false
bNeedingBGSkills = false

function explode(div,str) 
  if (div=='') then return false end
  local pos,arr = 0,{}
  -- for each divider found
  for st,sp in function() return string.find(str,div,pos,true) end do
    table.insert(arr,string.sub(str,pos,st-1)) -- Attach chars left of current divider
    pos = sp + 1 -- Jump past current divider
  end
  table.insert(arr,string.sub(str,pos)) -- Attach chars right of last divider
  return arr
end

-- This is the *OLD* way of getting mindspace values and skills, done by typing "mindspace old" - not really recommended any more!
function QuowMindspaceGetter (sName, sLine, wildcards)
  -- Let a user force-update all skills the old fashioned unreliable way
  iQuowNeed = 0
  iQuowDone = 0
  EnableTrigger("QuowMindspaceCheck", true)
  EnableTrigger("List_QuowMindspaceCheck", true)
  for sSkillName, iValue in pairs(sQuowSkillTree) do
    EnableTrigger(sSkillName, true)
    EnableTrigger("List_" .. sSkillName, true)
    iQuowNeed = iQuowNeed + 1
  end
  ColourNote("red", "", "Wait a moment, checking your skills and recording your bonuses in memory...")
  bNoisyMindspace = true
  -- Be specific with what skills we want...
  SendNoEcho("skills ma.sp.sp raw")
  SendNoEcho("skills magic,cr.smi.gold,cr.smi.silver,cr.car.turning,cr.car.whittling,cr.husb.plant.herbal,cr.pott.forming.shaping,cr.mat.weaving")
end

-- This is the *OLD* handler for seeing a method name in the MUD output, used with the above old "QuowMindspaceGetter"
function QuowGetMethod (sName, sLine, wildcards)
  EnableTrigger(sName, false)
  EnableTrigger("List_" .. sName, false)
  if (string.sub(sName, 1, 5) == "List_") then
    sName = string.sub(sName, 6)
  end
  local iThisBonus = tonumber(wildcards.bonus)
  if (sQuowSkillTree[sName] ~= nil) then
    objMindspaceSkillsPerAlt[sCurrentCharacter][sName] = tonumber(iThisBonus)
    iQuowDone = iQuowDone + 1
    if (iQuowDone >= iQuowNeed) then
      SetVariable("SkillsPerAlt", json.encode(objMindspaceSkillsPerAlt))
      local sCommand = 'ColourNote ("yellow", "", "Skills and mindspace recorded, you can now spellcheck with:  mindspace <acronym>  or lookup a skill with:  mindspace <skill>")'
      DoAfterSpecial (0.2, sCommand, sendto.script)
    end
  end
end

-- List all spells from a given bookID
function QuowSpellbook(iThisBookID)
  iThisBookID = tonumber(iThisBookID)
  if (sQuowBooks[iThisBookID]) then
    Note("")
    ColourTell("silver", "", "Listing spells found in book '")
    ColourTell("cyan", "", sQuowBooks[iThisBookID][1])
    ColourNote("silver", "", "'")
    ColourNote("silver", "", "(" .. sQuowBooks[iThisBookID][3] .. "):")
    Note("")
    local iCount = 0
    for sKey, iValue in pairs(objQuowSpellData) do
      -- Is it the right bookID?
      if (iValue[5] == iThisBookID) then
        iCount = iCount + 1
        ColourTell("silver", "", string.format("%-2s ", iCount) .. ": ")
        Hyperlink ("!!bff25338e014986ba3b56e2c:QuowShowSpell(" .. sKey .. ")", iValue[2], "Show full details for this spell", "cyan", "", 0)
        ColourTell("silver", "", " - " .. sKey .. " (")
        if (iValue[3] == "Miscellaneous") then
           ColourTell("silver", "", "misc")
        elseif (iValue[3] == "Offensive") then
           ColourTell("silver", "", "off")
        else
           ColourTell("silver", "", "def")
        end
        ColourTell("silver", "", ") [")
        Tell("size:" .. iValue[1] .. ", GP:" ..  iValue[4])
        ColourNote("silver", "", "]")
      end
    end
    Note("")
  end
end

-- For knowing the last book referenced to show with 'mindspace book' for screenreader users
iLastBook = 0
function QuowShowSpell(sSpellName)
  if (objQuowSpellData[sSpellName] == nil) then
    return
  end
  local sAcronym = string.lower(objQuowSpellData[sSpellName][2])
  if (bScreenreaderMode == false) then
    Note("")
    ColourNote("orange", "", string.upper(sAcronym), "silver", "", ": ", "cyan", "", sSpellName, "silver", "", ".  Mindspace = ", "orange", "", tostring(objQuowSpellData[sSpellName][1]), "silver", "", ", GP Cost = ", "orange", "", tostring(objQuowSpellData[sSpellName][4]))
    -- Any stats?
    if (objSpellInfoPerAlt[sCurrentCharacter] and objSpellInfoPerAlt[sCurrentCharacter][sSpellName]) then
      --ColourNote("silver", "", "[spell stats for " .. sCurrentCharacter .. "]")
      ColourTell("darkorange", "", "First cast: " .. os.date("%d %b %Y @ %H:%M:%S", objSpellInfoPerAlt[sCurrentCharacter][sSpellName].first))
      ColourNote("darkorange", "", "      Last cast: " .. os.date("%d %b %Y @ %H:%M:%S", objSpellInfoPerAlt[sCurrentCharacter][sSpellName].last))
      ColourNote("darkorange", "", "Total cast: " .. objSpellInfoPerAlt[sCurrentCharacter][sSpellName].casts)
    end
    ColourNote("silver", "", "It is categorised as ", "orange", "", objQuowSpellData[sSpellName][3], "silver", "", ".")
    ColourNote("silver", "", "Components: " .. objQuowSpellData[sSpellName][8])
    if (objQuowSpellData[sSpellName][7] == true) then
      ColourNote("silver", "", "This is a witch spell.")
    else
      local iBook = objQuowSpellData[sSpellName][5]
      if (sQuowBooks[iBook] ~= nil) then
        -- Hyperlink book ID
        iLastBook = iBook
        ColourTell("silver", "", "It is found in '")
        Hyperlink ("!!bff25338e014986ba3b56e2c:QuowSpellbook(" .. iBook .. ")", sQuowBooks[iBook][1] .. "' - '" .. sQuowBooks[iBook][2], "Show all spells in this book", "cyan", "", 0)
        ColourNote("silver", "", "'.")
        ColourNote("orange", "", sQuowBooks[iBook][3] .. ".")
      else
        ColourNote("silver", "", "It is unknown where this spell can be obtained.")
      end
    end
    -- Get the spellcheck data and display it nicely?
    Note("")
    ColourNote("silver", "", "(type '", "cyan", "", "mindspace skills", "silver", "", "' to update the plugin with your current bonuses for accurate spellchecks)")
    ColourNote("orange", "", "Skill        Fail ->->->->->->->->->->->-> Equal ->->->->->->->->->->->- Success  Chance [bonus]")
  --                             water        <320  320+  334+  344+  349+  354+  365+  372+  389+  410+  449+
  else
    -- Screenreader mode
    Note("")
    ColourNote("silver", "", "Spellcheck for ", "orange", "", string.upper(sAcronym), "silver", "", ". " .. sSpellName .. ". " .. objQuowSpellData[sSpellName][3] .. ". Mindspace ", "orange", "", tostring(objQuowSpellData[sSpellName][1]), "silver", "", ". GP cost ", "orange", "", tostring(objQuowSpellData[sSpellName][4]))
    ColourNote("silver", "", "Components: " .. objQuowSpellData[sSpellName][8])
    if (objQuowSpellData[sSpellName][7] == true) then
      ColourNote("silver", "", "This is a witch spell.")
    else
      local iBook = objQuowSpellData[sSpellName][5]
      if (sQuowBooks[iBook] ~= nil) then
        -- Hyperlink book ID
        iLastBook = iBook
        ColourNote("silver", "", "It is found in " .. sQuowBooks[iBook][1] .. ", " .. sQuowBooks[iBook][2] .. ".")
        ColourNote("orange", "", sQuowBooks[iBook][3] .. ".")
      else
        ColourNote("silver", "", "It is unknown where this spell can be obtained.")
      end
    end
    Note("")
  end
  local iMyOrder = 0
    -- Primary flag
  if (sOrderShorts[sCurrentSpec] ~= nil) then
    iMyOrder = sOrderShorts[sCurrentSpec]
  elseif (sCurrentGuild == "wizards") then
    iMyOrder = 3
  end
  local iMCount = 0
  for sKey, iValue in pairs (objQuowSpellData[sSpellName][6]) do
    local iMyBonus = objMindspaceSkillsPerAlt[sCurrentCharacter][iValue[1]]
    if (iMyBonus == nil) then
      iMyBonus = 0
    end
    local sFormatStringSkill = ""
    local sFormatStringPre = ""
    local sFormatStringMid = ""
    local sFormatStringPost = ""
    sFormatStringSkill = string.format("%-12s ", iValue[1])
    local iN = 0
    local iMyLevel = 1
    local iThisDifficulty = 0
    for iN = 1, 11 do
      if (iN == 1) then
        iThisDifficulty = iValue[2]
      else
        iThisDifficulty = iValue[iN]
      end
      if (iMyBonus >= iThisDifficulty) then
        iMyLevel = iN
      end
    end
    for iN = 1, 11 do
      local sBonus = ""
      if (iN == 1) then
        sBonus = "<" .. tostring(iValue[2])
      else
        sBonus = tostring(iValue[iN])
      end
      if (iN < iMyLevel) then
        sFormatStringPre = sFormatStringPre .. string.format("%-6s", sBonus)
      elseif (iN == iMyLevel) then
        sFormatStringMid = sFormatStringMid .. string.format("%-6s", sBonus)
      else
        sFormatStringPost = sFormatStringPost .. string.format("%-6s", sBonus)
      end
    end
    if (bScreenreaderMode == false) then 
      ColourTell("silver", "", sFormatStringSkill, "cyan", "", sFormatStringPre, "orange", "", sFormatStringMid, "red", "", sFormatStringPost, "silver", "", "   " .. sQuowSkillLevels[iMyLevel] .. " [" .. tostring(iMyBonus) .. "]")
      if (iMyOrder > 0 and sQuowSkillTree[iValue[1]] ~= nil and sQuowSkillTree[iValue[1]][3] ~= nil and sQuowSkillTree[iValue[1]][3][iMyOrder] == true) then
        ColourTell("silver", "", " *P*")
      end
      Note("")
    else
      iMCount = iMCount + 1
      ColourTell("silver", "", "Step " .. iMCount .. ", ", "cyan", "", iValue[1], "silver", "", ", you are at ", "orange", "", sQuowSkillLevels[iMyLevel], "silver", "", " to succeed. ")
      if (iMyLevel < 6) then
        ColourTell("silver", "", "Need ", "orange", "", iValue[7], "silver", "", " bonus for half chance. ")
      end
      if (iMyLevel < 11) then
        ColourTell("silver", "", "Need ", "orange", "", iValue[11], "silver", "", " bonus for max chance.")
      end
      Note("")
    end
  end
  if (bScreenreaderMode == true) then 
    ColourNote("orange", "", "End of mindspace spellcheck for " .. string.upper(sAcronym))
  end
end

-- The core command-handler for the plugin, when a user types the "mindspace" command with or without arguments
bStatResetRequest = false
function QuowMindspaceSetter (sName, sLine, wildcards)
  if (wildcards[1] == nil) then
    wildcards[1] = "skills"
  end
  local iThisSpace = tonumber(wildcards[1])
  if (iThisSpace == nil or iThisSpace == 0) then
    local sAcronym = string.lower(wildcards[1])
    local bAnyFound = false
    local sSpellName = ""
    if (sAcronym == "help") then
      -- Show the helpfile
      QuowMindspaceHelp()

    elseif (sAcronym == "version") then
      ColourNote("darkorange", "", "Quow's Mindspace Plugin is on version: " .. tostring(GetPluginInfo("bff25338e014986ba3b56e2c", 19)) .. "  [" .. os.date("%d %b %Y", GetPluginInfo("bff25338e014986ba3b56e2c", 14)) .. "]")

    elseif (sAcronym == "debug") then
      ColourTell("darkorange", "", "Quow's Mindspace Plugin thinks your character is '" .. tostring(sCurrentCharacter) .. "', your order is '" .. tostring(sCurrentGuild) .. "' and your spec is '" .. tostring(sCurrentSpec) .. "'")
      if (PluginSupports("bfe35205f026786ea1d56e3b", "CheckGuildSpec") == 0) then
        ColourNote("darkorange", "", ".  Your CowBar version supports this feature.")
      else
        ColourNote("darkorange", "", ".  Your CowBar version does NOT support this feature - update it.")
      end

    elseif (sAcronym == "books") then
      -- List all books
      for sKey, iValue in ipairs(sQuowBooks) do
        Hyperlink ("!!bff25338e014986ba3b56e2c:QuowSpellbook(" .. sKey .. ")", iValue[1], "", "orange", "", 0)
        Note("")
        ColourTell("silver", "", "  [" .. iValue[3] .. "]")
        Note("")
      end
    elseif (sAcronym == "book" and sQuowBooks[iLastBook] ~= nil) then
      -- Show the last referenced book
      QuowSpellbook(iLastBook)

    elseif (string.sub(sAcronym, 1, 5) == "book " and string.len(sAcronym) > 5) then
      -- Detail a specific numbered book
      sAcronym = string.sub(sAcronym, 6)
      local iWantBook = tonumber(sAcronym)
      if (iWantBook ~= nil) then
        for sKey, iValue in ipairs(sQuowBooks) do
          if (iValue[4] and iValue[4] == iWantBook) then
            QuowSpellbook(sKey)
            break
          end
        end
      end

    elseif (sAcronym == "alts") then
      ColourNote("darkorange", "", "Mindspace plugin knows the following characters or alts:")
      local iCount = 0
      for sListAlt, __ in pairs(objMindspaceSkillsPerAlt) do
        if (sListAlt ~= "NoName") then
          iCount = iCount + 1
          ColourNote("silver", "", tostring(iCount) .. ": ", "cyan", "", sListAlt)
          --Hyperlink ("!!bff25338e014986ba3b56e2c:CharacterSwitch(" .. sListAlt .. ")", sListAlt, "Switch to this character", "silver", "", 0, true)
          --Note("")
        end
      end
      ColourNote("darkorange", "", "End of known characters.")

    elseif (string.sub(sAcronym, 1, 3) == "su " and string.len(sAcronym) > 5) then
      local sTempCharacter = string.sub(sAcronym, 4)
      if (sTempCharacter ~= nil and sTempCharacter ~= "") then
        ColourNote("darkorange", "", "Mindspace plugin alt is now being force-set to: '" .. sTempCharacter .. "'")
        CharacterSwitch(sTempCharacter)
      end

    -- The special "sorted" or "difficulty" filtering, with optional witch, category, and mindspace argument support
    elseif (string.sub(sAcronym, 1, 6) == "sorted" or string.sub(sAcronym, 1, 6) == "spells" or string.sub(sAcronym, 1, 10) == "difficulty") then
      -- Core command strip
      local bSpellSort = false
      if (string.sub(sAcronym, 1, 6) == "sorted") then
        sAcronym = string.sub(sAcronym, 8)
      elseif (string.sub(sAcronym, 1, 6) == "spells") then
        sAcronym = string.sub(sAcronym, 8)
        bSpellSort = true
      elseif (string.sub(sAcronym, 1, 10) == "difficulty") then
        sAcronym = string.sub(sAcronym, 12)
      end
      -- Look for witch tag
      local bWitchery = false
      if (string.sub(sAcronym, 1, 5) == "witch") then
        sAcronym = string.sub(sAcronym, 7)
        bWitchery = true
      end
      -- Look for category tags
      local sCategory = ""
      if (string.sub(sAcronym, 1, 9) == "defensive") then
        sAcronym = string.sub(sAcronym, 11)
        sCategory = "defensive"
      elseif (string.sub(sAcronym, 1, 9) == "offensive") then
        sAcronym = string.sub(sAcronym, 11)
        sCategory = "offensive"
      elseif (string.sub(sAcronym, 1, 13) == "miscellaneous") then
        sAcronym = string.sub(sAcronym, 15)
        sCategory = "misc"
      elseif (string.sub(sAcronym, 1, 3) == "def") then
        sAcronym = string.sub(sAcronym, 5)
        sCategory = "defensive"
      elseif (string.sub(sAcronym, 1, 3) == "off") then
        sAcronym = string.sub(sAcronym, 5)
        sCategory = "offensive"
      elseif (string.sub(sAcronym, 1, 4) == "misc") then
        sAcronym = string.sub(sAcronym, 6)
        sCategory = "misc"
      end
      -- And finally see if we have a max mindspace filter to parse
      local iMaxMindspace = 0
      if (string.len(sAcronym) > 0 and tonumber(sAcronym) ~= nil) then
        iMaxMindspace = tonumber(sAcronym)
      end
      -- Put it all together
      CalculateDifficultyList(bWitchery, sCategory, iMaxMindspace, bSpellSort)

    elseif (sAcronym == "screenreader") then
      if (bScreenreaderMode == true) then
        ColourNote("darkorange", "", "Quow's mindspace plugin will now output in full colour numbers mode.")
        bScreenreaderMode = false
      else
        ColourNote("darkorange", "", "Quow's mindspace plugin will now try to output some things in a simpler way.")
        bScreenreaderMode = true
      end
      SetVariable("bMindspaceReader", tostring(bScreenreaderMode))

    elseif (string.sub(sAcronym, 1, 6) == "order " and string.len(sAcronym) > 6) then
      -- Show specific info on a given order
      sAcronym = string.sub(sAcronym, 7)
      if (sOrderShorts[sAcronym] == nil) then
        -- Maybe they gave a number, try that?
        local iPossibleOrderID = tonumber(sAcronym)
        if (iPossibleOrderID ~= nil and iPossibleOrderID > 0 and sQuowOrders[iPossibleOrderID]) then
          QuowOrderInfo(iPossibleOrderID)
        else
          ColourNote("darkorange", "", "Quow's mindspace plugin doesn't recognise '" .. sAcronym .. "' as an Order name, try a hedge colour like 'white', or a short like 'circle'.")
          return
        end
      else
        QuowOrderInfo(sOrderShorts[sAcronym])
      end

    -- Exactly orders, nothing extra (eg a comma-separated list)
    elseif (sAcronym == "orders") then
      ColourNote("darkorange", "", "Quow's Mindspace Plugin knows the following Orders:")
      for iOrderNum, objOrderData in ipairs(sQuowOrders) do
        Hyperlink ("!!bff25338e014986ba3b56e2c:QuowOrderInfo(" .. iOrderNum .. ")", string.format("%-" .. (2-string.len(iOrderNum)) .. "s ", iOrderNum), "Show Order info", "silver", "", 0, true)
        ColourTell("silver", "", ": ")
        Hyperlink ("!!bff25338e014986ba3b56e2c:QuowOrderInfo(" .. iOrderNum .. ")", objOrderData[1], "Show Order info", "cyan", "", 0, true)
        ColourNote("silver", "", "- " .. objOrderData[2])
      end
      if (bScreenreaderMode == false) then
        Note("")
      end
      ColourNote("darkorange", "", "To sort the orders from most-total-primaries, to least, for a given set of spells, use the syntax:")
      ColourNote("cyan", "", "mindspace orders <spells>", "silver", "", " for example 'mindspace orders tpa,jpct,dkdd,tig'")
      if (bScreenreaderMode == false) then
        Note("")
      end

    elseif (sAcronym == "quowquiz") then
      -- This is right now just for a quiz question Quow ran, maybe I will format the output of this better for public use later!
      -- If you found this though, feel free to run it for interest sake!
      local iOrderScores = {}
      for sSpellKey, iSpellValue in pairs (objQuowSpellData) do
        if (iSpellValue[7] == false) then
          local oSpellTable = explode(",", iSpellValue[2])
          local iTotalMethods = 0
          local bNeedComma = false
          local iOrderCounts = {{0, 1}, {0, 2}, {0, 3}, {0, 4}, {0, 5}, {0, 6}, {0, 7}, {0, 8}}
          for iThisSpell, sThisAcronym in pairs(oSpellTable) do
            -- See if any spells appear
            for sKey, iValue in pairs(objQuowSpellData) do
              if (iValue[2] == sThisAcronym or string.lower(sKey) == sThisAcronym) then
                for _, sMethodCheck in pairs(iValue[6]) do
                  -- Method for desired spell, add up orders with it
                  iTotalMethods = iTotalMethods + 1
                  for __, iThisOrder in pairs(sQuowSkillTree[sMethodCheck[1]][2]) do
                    iOrderCounts[iThisOrder][1] = iOrderCounts[iThisOrder][1] + 1
                  end
                end
                if (bNeedComma == true) then
                end
                bNeedComma = true
                break
              end
            end
          end
          table.sort(iOrderCounts, QuowSortBonuses)
          for sKey, iValue in pairs(iOrderCounts) do
            if (iValue[1] == iTotalMethods) then
              if (iOrderScores[iValue[2]] == nil) then
                iOrderScores[iValue[2]] = 0
              end
              iOrderScores[iValue[2]] = iOrderScores[iValue[2]] + 1
              ColourTell("yellow", "", iSpellValue[2] .. ": ")
              ColourTell("orange", "", sQuowOrders[iValue[2]][1])
              ColourTell("silver", "", ": ")
              ColourNote("cyan", "", iValue[1] .. " / " .. iTotalMethods)
            end
          end
        end
      end
      for sKey, iValue in pairs(iOrderScores) do
        ColourTell("orange", "", sQuowOrders[sKey][1] .. ":")
        ColourTell("yellow", "", iValue)
        Note("")
      end

    elseif (string.sub(sAcronym, 1, 7) == "orders " and string.len(sAcronym) > 9) then
      -- Do the Orders list calculations
      sAcronym = string.sub(sAcronym, 8)
      sAcronym = string.gsub(sAcronym, ", ", ",")
      local oSpellTable = explode(",", sAcronym)
      local iTotalMethods = 0
      local bNeedComma = false
      local iOrderCounts = {{0, 1}, {0, 2}, {0, 3}, {0, 4}, {0, 5}, {0, 6}, {0, 7}, {0, 8}}
      ColourTell("silver", "", "Tallying primaries for recognised spells: ")
      for iThisSpell, sThisAcronym in pairs(oSpellTable) do
        -- See if any spells appear
        for sKey, iValue in pairs(objQuowSpellData) do
          if (iValue[2] == sThisAcronym or string.lower(sKey) == sThisAcronym) then
            for _, sMethodCheck in pairs(iValue[6]) do
              -- Method for desired spell, add up orders with it
              iTotalMethods = iTotalMethods + 1
              for __, iThisOrder in pairs(sQuowSkillTree[sMethodCheck[1]][2]) do
                iOrderCounts[iThisOrder][1] = iOrderCounts[iThisOrder][1] + 1
              end
            end
            if (bNeedComma == true) then
              ColourTell("silver", "", ",")
            end
            ColourTell("cyan", "", sThisAcronym)
            bNeedComma = true
            break
          end
        end
      end
      Note("")
      table.sort(iOrderCounts, QuowSortBonuses)
      for sKey, iValue in pairs(iOrderCounts) do
        ColourTell("orange", "", sQuowOrders[iValue[2]][1])
        ColourTell("silver", "", ": ")
        ColourNote("cyan", "", iValue[1])
      end
      ColourNote("silver", "", "(out of a maximum score of " .. iTotalMethods .. " each)")
      Note("-- end of rankings list --")

    -- Exactly primaries, list our apparently known ones
    elseif (sAcronym == "primaries") then
      local iMyOrder, sMyGuildGuess = 0, "Unknown"
      -- Primary flag
      if (sOrderShorts[sCurrentSpec] ~= nil) then
        iMyOrder = sOrderShorts[sCurrentSpec]
        sMyGuildGuess = sCurrentSpec:gsub("^%l", string.upper)
      elseif (sCurrentGuild == "wizards") then
        iMyOrder = 3
        sMyGuildGuess = "Wizzard"
      end
      if (iMyOrder == 0) then
        ColourNote("darkorange", "", "Quow's Mindspace Plugin was not able to connect you to an Order with known primaries.")
      else
        ColourNote("darkorange", "", "Quow's Mindspace Plugin has these as the primaries for your current character [" .. sCurrentCharacter:gsub("^%l", string.upper) .. " - " .. sMyGuildGuess .. "]:")
        if (bScreenreaderMode == false) then
          ColourNote("silver", "", "ma.sp.offensive")
          ColourNote("silver", "", "ma.sp.defensive")
          ColourNote("silver", "", "ma.sp.misc")
          ColourNote("silver", "", "ma.sp.special")
          ColourNote("silver", "", "ma.points")
        else
          ColourNote("silver", "", "Offensive")
          ColourNote("silver", "", "Defensive")
          ColourNote("silver", "", "Misc")
          ColourNote("silver", "", "Special")
          ColourNote("silver", "", "Points")
        end
        for iSkillNum, sSkillName in ipairs(iQuowSkillOrder) do
          for _, iThisOrder in pairs(sQuowSkillTree[sSkillName][2]) do
            if (iThisOrder == iMyOrder) then
              if (bScreenreaderMode == false) then
                Hyperlink("mindspace " .. sSkillName, sQuowSkillTree[sSkillName][1], "", "cyan", "", 0)
              else
                Hyperlink("mindspace " .. sSkillName, sSkillName, "", "cyan", "", 0)
              end
              ColourNote("silver", "", ": " .. tostring(objMindspaceSkillsPerAlt[sCurrentCharacter][sSkillName]) .. " bonus")
            end
          end
        end
        Note("-- End of Mindspace primary list --")

      end

    elseif (sAcronym == "statreset confirm" and bStatResetRequest == true) then
      --for sStatAlt, objStatData in pairs(objSpellInfoPerAlt) do
      --  objSpellInfoPerAlt[sStatAlt] = {}
      --end
      objSpellInfoPerAlt[sCurrentCharacter] = {}
      SetVariable("SpinfoPerAlt", json.encode(objSpellInfoPerAlt))
      ColourNote("red", "", "Quow's Mindspace and Spellcheck stats:")
      ColourNote("darkorange", "", "Your spell casting stats for character '", "cyan", "", sCurrentCharacter, "darkorange", "", "' have now been reset to zero, as if you had never cast any spells!")
      bStatResetRequest = false

    elseif (sAcronym == "statreset") then
      if (bScreenreaderMode == false) then
        Note("")
        ColourNote("red", "", "Quow's Mindspace and Spellcheck WARNING:")
      end
      ColourNote("darkorange", "", "Are you SURE you want to reset the mindspace plugin cast stats for character '", "cyan", "", sCurrentCharacter, "darkorange", "", "'?  This will clear all your cast spells (how many of each spell you have ever cast), and CANNOT be undone!")
      ColourNote("silver", "", "If you are certain, enter this command; '", "cyan", "", "mindspace statreset confirm", "silver", "", "'")
      ColourNote("silver", "", "This will instantly clear your cast stats on '" .. sCurrentCharacter .. "' with no further confirmations.")
      bStatResetRequest = true

    -- Spellcast stats for everyone
    elseif (sAcronym == "stats") then
      ShowSpellStats()

    -- Stats for a specific alt
    elseif (string.sub(sAcronym, 1, 6) == "stats " and string.len(sAcronym) > 8) then
      local sStatAlt = string.lower(string.sub(sAcronym, 7))
      if (objSpellInfoPerAlt[sStatAlt]) then
        ShowSpellStats(sStatAlt)
      else
        ColourNote("darkorange", "", "No spellcast stats found for the character '" .. sStatAlt .. "'.")
      end

    -- Update/grab skills from the CowBar/Discworld
    elseif (sAcronym == "skills") then
      -- We want to check their skills, see if we can do it the new CowBar way, or the old way
      if (PluginSupports("bfe35205f026786ea1d56e3b", "SkillsRequest") == 0) then
        bWaitingForUpdate = true
        bNeedingBGStats = true
        bNeedingBGSkills = true
        iGotStats = 0
        EnableTrigger("Stat_1", true)
        EnableTrigger("Stat_2", true)
        EnableTrigger("Stat_3", true)
        EnableTrigger("Stat_4", true)
        EnableTrigger("Stat_5", true)
        CallPlugin ("bfe35205f026786ea1d56e3b", "SkillsRequest")
        ColourNote("red", "", "Wait a moment, checking your stats, and recording your bonuses in memory...")
        SendNoEcho("noalias score verbose stats")
      else
        -- Old fashioned reliable way
        iQuowNeed = 0
        iQuowDone = 0
        EnableTrigger("QuowMindspaceCheck", true)
        EnableTrigger("List_QuowMindspaceCheck", true)
        for sKey, iValue in pairs(sQuowSkillTree) do
          EnableTrigger(sKey, true)
          EnableTrigger("List_" .. sKey, true)
          iQuowNeed = iQuowNeed + 1
        end
        ColourNote("red", "", "Wait a moment, checking your skills and recording your bonuses in memory...")
        bNoisyMindspace = false
        -- Be specific with what skills we want...
        SendNoEcho("skills ma.sp.sp raw")
        SendNoEcho("skills magic,cr.smi.gold,cr.smi.silver,cr.car.turning,cr.car.whittling,cr.husb.plant.herbal,cr.pott.forming.shaping,cr.mat.weaving")
      end
    elseif (sAcronym == "skillsold") then
      -- Emergency backup - let a user force-update all skills the old fashioned reliable way
      iQuowNeed = 0
      iQuowDone = 0
      EnableTrigger("QuowMindspaceCheck", true)
      EnableTrigger("List_QuowMindspaceCheck", true)
      for sKey, iValue in pairs(sQuowSkillTree) do
        EnableTrigger(sKey, true)
        EnableTrigger("List_" .. sKey, true)
        iQuowNeed = iQuowNeed + 1
      end
      ColourNote("red", "", "Wait a moment, checking your skills and recording your bonuses in memory...")
      bNoisyMindspace = false
      -- Be specific with what skills we want...
      SendNoEcho("skills ma.sp.sp raw")
      SendNoEcho("skills magic,cr.smi.gold,cr.smi.silver,cr.car.turning,cr.car.whittling,cr.husb.plant.herbal,cr.pott.forming.shaping,cr.mat.weaving")

    else
      -- See if any spells appear
      for sKey, iValue in pairs (objQuowSpellData) do
        if (iValue[2] == sAcronym or string.lower(sKey) == sAcronym) then
          sSpellName = sKey
          bAnyFound = true
          break
        end
      end
      -- Still not found, check for alternative nicknames
      if (bAnyFound == false) then
        if (sAcronymToSpell[string.lower(sAcronym)]) then
          sSpellName = sAcronymToSpell[string.lower(sAcronym)]
          bAnyFound = true
        end
      end
      -- Show spell output or not
      if (bAnyFound == true) then
        QuowShowSpell(sSpellName)
      else
        -- Check if they wanted to check a TM-able skill or not - and look for witch flag
        local sSkill = string.lower(wildcards[1])
        bWitchSpells = false
        if (string.sub(sSkill, -6) == " witch") then
          sSkill = string.sub(sSkill, 0, -7)
          bWitchSpells = true
        end
        -- See if we have a mindspace cap addon to the end
        local iSplitSpace = string.find(sSkill, " ")
        local iMindspaceCap = 0
        if (iSplitSpace ~= nil and iSplitSpace > 0) then
          iMindspaceCap = tonumber(string.sub(sSkill, iSplitSpace + 1))
          sSkill = string.sub(sSkill, 1, iSplitSpace - 1)
          if (iMindspaceCap == nil) then
            iMindspaceCap = 0
          end
        end
        -- Check if we have a single method or comma-separated list of methods, else default to an error

        sSkill = string.gsub(sSkill, ", ", ",") -- Turn spaced-commas into plain-commas
        local oMethodTable = explode(",", sSkill) -- Explode into an array
        local iValidMethods = 0
        for iKey, sMethodName in pairs(oMethodTable) do
          if (sQuowSkillTree[sMethodName]) then
            iValidMethods = iValidMethods + 1
          end
        end

        if (iValidMethods == 0) then
          Note("")
          ColourNote("orange", "", "Unable to find any spell with the acronym of: " .. wildcards[1])
          ColourNote("orange", "", "(for TM possibilities, type 'mindspace <full skillname>' eg 'mindspace channeling', don't use the full skill tree path)")
        else
          Note("")

          local bDoneMethodReminder = false
          local sSkillsChecking = ""
          local sDesiredMethods = {}
          local iUniqueMethodsWanted = 0
          -- Loop through comma-given-methods
          for iKey, sMethodName in pairs(oMethodTable) do
            if (sQuowSkillTree[sMethodName]) then
              -- Check it's unique
              if (sDesiredMethods[sMethodName] == nil) then
                -- Cache this one
                sDesiredMethods[sMethodName] = true
                iUniqueMethodsWanted = iUniqueMethodsWanted + 1
                -- Method name string prep
                if (sSkillsChecking ~= "") then
                  sSkillsChecking = sSkillsChecking .. ", "
                end
                sSkillsChecking = sSkillsChecking .. sMethodName
                -- Bonus checks
                local iMyBonus = objMindspaceSkillsPerAlt[sCurrentCharacter][sMethodName]
                if (iMyBonus == 0 and bDoneMethodReminder == false) then
                  ColourNote("red", "", "Have you typed 'mindspace skills' for the plugin to record your bonuses?")
                  bDoneMethodReminder = true
                end
                sSkillsChecking = sSkillsChecking .. " [" .. iMyBonus .. "]"
              end 
            end
          end

          ColourNote("orange", "", "All spells that use '" .. sSkillsChecking .. "'")
          if (bWitchSpells == true) then
            ColourNote("silver", "", "(filtering by witch spells only)")
          end
          if (iMindspaceCap > 0) then
            ColourNote("silver", "", "[with a maximum mindspace of " .. tostring(iMindspaceCap) .. "]")
          end
          -- Loop through all spell tables
          local iBonusDistanceDown = nil
          local sSpellDown = ""
          local sSpellDownName = ""
          local iBonusDistanceUp = nil
          local sSpellUp = ""
          local sSpellUpName = ""
          local iThisDistance = 0
          local iThis
          local sSortedSpells = {}
          for sKey, iValue in pairs (objQuowSpellData) do
            -- Look for matching skills
            -- Ignore witch spells unless we intentionally want them, and also check for the mindspace cap
            if (iValue[7] == bWitchSpells and (iMindspaceCap == 0 or iValue[1] <= iMindspaceCap)) then
              -- Store which methods we checked by unique name only (in case of double-air for example)
              local sCheckedUniqueMethods = {} 
              local sMatchedUniqueMethods = {}
              local iUniqueMethods = 0
              local iUniqueMatchedMethods = 0
              local bStoreThisSpell = false
              local iThisBonusDistanceUp = nil
              local iThisBonusDistanceDown = nil
              for sSkillKey, iSkillValue in pairs (iValue[6]) do
                -- See if we already checked this unique-method as a method-count
                if (sCheckedUniqueMethods[iSkillValue[1]] == nil) then
                  -- We haven't yet checked a method by this same name
                  iUniqueMethods = iUniqueMethods + 1
                  sCheckedUniqueMethods[iSkillValue[1]] = iUniqueMethods
                end
                -- Is this a unique-match?
                if (sDesiredMethods[iSkillValue[1]] and sMatchedUniqueMethods[iSkillValue[1]] == nil) then
                  -- We haven't yet matched a method by this same name
                  iUniqueMatchedMethods = iUniqueMatchedMethods + 1
                  sMatchedUniqueMethods[iSkillValue[1]] = iUniqueMatchedMethods
                end
                -- At this point we know how many unique methods (so far...) we need, and how many unique matches (so far...) we have, for a final tally later

                -- Now, if this is ANY sort of match (unique or not), work out the bonus-difficulties/difference between our bonus and spell difficulty
                if (sDesiredMethods[iSkillValue[1]]) then
                  iTempDistance = objMindspaceSkillsPerAlt[sCurrentCharacter][iSkillValue[1]] - iSkillValue[6] -- This is iMyBonus - difficulty of this method
                  -- See if this is the "best" difficulty - for *THIS* spell's wanted methods yet seen;
                  if (iTempDistance <= 0) then
                    -- Above your bonus (harder)
                    if (iThisBonusDistanceDown == nil or iTempDistance >= iThisBonusDistanceDown) then
                      iThisBonusDistanceDown = iTempDistance
                      iThisDistance = iTempDistance
                    end
                  elseif (iTempDistance > 0) then
                    -- Below your bonus (easier)
                    if (iThisBonusDistanceUp == nil or iTempDistance <= iThisBonusDistanceUp) then
                      iThisBonusDistanceUp = iTempDistance
                      iThisDistance = iTempDistance
                    end
                  end
                  if (iThisDistance == nil) then
                    iThisDistance = iTempDistance
                  end
                end -- Valid method-match?

              end -- Loop through all methods of this skill

              -- Check if this was a storer or not (ie, we have enough matched methods as desired)
              if (iUniqueMatchedMethods >= iUniqueMethodsWanted) then
                -- See if this is the "best" difficulty-difference yet seen;
                if (iThisDistance <= 0) then
                  if (iBonusDistanceDown == nil or iThisDistance >= iBonusDistanceDown) then
                    iBonusDistanceDown = iThisDistance
                    sSpellDown = iValue[2]
                    sSpellDownName = sKey
                  end
                  sThisNote = tostring(-1 * iThisDistance) .. " ABOVE your bonus (harder)"
                elseif (iThisDistance > 0) then
                  if (iBonusDistanceUp == nil or iThisDistance <= iBonusDistanceUp) then
                    iBonusDistanceUp = iThisDistance
                    sSpellUp = iValue[2]
                    sSpellUpName = sKey
                  end
                  sThisNote = tostring(iThisDistance) .. " BELOW your bonus (easier)"
                end
                -- And insert it to the sortable table  
                table.insert(sSortedSpells, {iThisDistance, sKey, sThisNote})
                --ColourNote("silver", "", sKey .. " ('", "cyan", "", "mindspace " .. iValue[2], "silver", "", "') has a check ", "orange", "", sThisNote)
              end


            end -- Check if we're doing witch or non-witch
          end -- Loop through all spells
          if (#sSortedSpells > 0) then
            table.sort(sSortedSpells, QuowSortBonuses)
            for sKey, iValue in pairs (sSortedSpells) do
              ColourTell("orange", "", iValue[3] .. " ", "silver", "", iValue[2] .. " [")
              Hyperlink ("!!bff25338e014986ba3b56e2c:QuowShowSpell(" .. iValue[2] .. ")", objQuowSpellData[iValue[2]][2], "Show full details for this spell", "cyan", "", 0)
              ColourNote("silver", "", "]")
            end
            sSortedSpells = nil
            if (sSpellDown == "" and sSpellUp == "") then
              ColourNote("orange", "", "Sorry, but no spells using that skill could be found.")
            else
              ColourNote("orange", "", "Possible TM spell suggestion(s):")
              if (sSpellDown ~= "") then
                ColourNote("silver", "", sSpellDownName .. " ('", "cyan", "", "mindspace " .. sSpellDown, "silver", "", "') for a harder spell")
              end
              if (sSpellUp ~= "") then
                ColourNote("silver", "", sSpellUpName .. " ('", "cyan", "", "mindspace " .. sSpellUp, "silver", "", "') for an easier spell")
              end
            end
          else
            ColourNote("silver", "", "Sorry, no spells found in the database using that method.")
          end
        end
      end
    end
  else
    iMindspaceSpecialPerAlt[sCurrentCharacter] = iThisSpace
    ColourNote("silver", "", "Mindspace manually set to ", "orange", "", tostring(iMindspaceSpecialPerAlt[sCurrentCharacter]), "silver", "", " (this should be your ma.sp.sp raw bonus plus 30)")
    SetVariable("SpecialPerAlt", json.encode(iMindspaceSpecialPerAlt))
  end
end
-- End of command handler


-- Show spellcast stats for a specific alt, or everyone...
function ShowSpellStats(sSpecificAlt)
  if (sSpecificAlt == nil) then 
    sSpecificAlt = ""
    if (bScreenreaderMode == false) then
      Note("")
    end
    ColourNote("cyan", "", "Spellcast Total-Cast Stats:")
  else
    ColourNote("cyan", "", "Spellcast Total-Cast Stats for '" .. sSpecificAlt .. "':")
  end

  local iNow = os.time()
  for sStatAlt, objStatData in pairs(objSpellInfoPerAlt) do
    -- Check if there's any data for this character or not
    local next = next
    if (next(objStatData) ~= nil) then
      if (sSpecificAlt == "" or sStatAlt == sSpecificAlt) then
        local iAltEarliest, iUniqueSpells, iTotalCasts, iTotalThaums, iSpellThaums, iPerDay = iNow, 0, 0, 0, 0, 0
        local iOffCasts, iOffThaums, iMiscCasts, iMiscThaums, iDefCasts, iDefThaums = 0, 0, 0, 0, 0, 0
        ColourNote("darkorange", "", "For '" .. sStatAlt .. "':")
        for sStatSpell, objFullData in pairs(objStatData) do
          -- Calculate thaums of this spell, and sum-total-thaums of this alt
          iUniqueSpells = iUniqueSpells + 1
          iTotalCasts = iTotalCasts + objFullData.casts
          iSpellThaums = (objQuowSpellData[sStatSpell][1] / 5) * objFullData.casts
          iTotalThaums = iTotalThaums + iSpellThaums
          -- Find the earliest spell of any spell cast by this alt, for time-divisions
          if (objFullData.first < iAltEarliest) then 
            iAltEarliest = objFullData.first
          end
          -- Per-category stats
          if (objQuowSpellData[sStatSpell][3] == "Offensive") then
            iOffCasts = iOffCasts + objFullData.casts
            iOffThaums = iOffThaums + iSpellThaums
          elseif (objQuowSpellData[sStatSpell][3] == "Defensive") then
            iDefCasts = iDefCasts + objFullData.casts
            iDefThaums = iDefThaums + iSpellThaums
          else
            iMiscCasts = iMiscCasts + objFullData.casts
            iMiscThaums = iMiscThaums + iSpellThaums
          end
          -- Display the stats of this individual spell
          Tell("  ")
          Hyperlink("!!bff25338e014986ba3b56e2c:QuowShowSpell(" .. sStatSpell .. ")", objQuowSpellData[sStatSpell][2], "Show full details for this spell", "cyan", "", 0)
          ColourNote("silver", "", " : ", "darkorange", "", "Casts: ", "silver", "", NumberCommaString(objFullData.casts) .. "  [creating " .. NumberCommaString(iSpellThaums) .. " thaums]  [first: " .. os.date("%d %b %Y @ %H:%M:%S", objFullData.first) .. ", last: " .. os.date("%d %b %Y @ %H:%M:%S", objFullData.last) .. "]") 
        end
        -- Display the sum-stats of this alt
        local iDaysRunning = math.ceil((iNow - iAltEarliest) / 86400)
        if (iDaysRunning < 1) then
          iDaysRunning = 1
        end
        local iTotalDailySpells, iTotalDailyThaums = math.floor(iTotalCasts / iDaysRunning), math.floor(iTotalThaums / iDaysRunning)
        ColourNote("silver", "", "For a total of: " .. NumberCommaString(iTotalCasts) .. " casts (" .. NumberCommaString(iTotalDailySpells) .. " daily, " .. iUniqueSpells .. " unique), creating " .. NumberCommaString(iTotalThaums) .. " thaums (" .. NumberCommaString(iTotalDailyThaums) .. " daily)")
        if (iOffCasts > 0) then
          local iThisSpellsDaily, iThisThaumsDaily = math.floor(iOffCasts / iDaysRunning), math.floor(iOffThaums / iDaysRunning)
          ColourNote("silver", "", " [", "yellow", "", "Off", "silver", "", ": " .. NumberCommaString(iOffCasts) .. " casts (" .. NumberCommaString(iThisSpellsDaily) .. " daily), creating " .. NumberCommaString(iOffThaums) .. " thaums (" .. NumberCommaString(iThisThaumsDaily) .. " daily)]")
        end
        if (iDefCasts > 0) then
          local iThisSpellsDaily, iThisThaumsDaily = math.floor(iDefCasts / iDaysRunning), math.floor(iDefThaums / iDaysRunning)
          ColourNote("silver", "", " [", "yellow", "", "Def", "silver", "", ": " .. NumberCommaString(iDefCasts) .. " casts (" .. NumberCommaString(iThisSpellsDaily) .. " daily), creating " .. NumberCommaString(iDefThaums) .. " thaums (" .. NumberCommaString(iThisThaumsDaily) .. " daily)]")
        end
        if (iMiscCasts > 0) then
          local iThisSpellsDaily, iThisThaumsDaily = math.floor(iMiscCasts / iDaysRunning), math.floor(iMiscThaums / iDaysRunning)
          ColourNote("silver", "", " [", "yellow", "", "Misc", "silver", "", ": " .. NumberCommaString(iMiscCasts) .. " casts (" .. NumberCommaString(iThisSpellsDaily) .. " daily), creating " .. NumberCommaString(iMiscThaums) .. " thaums (" .. NumberCommaString(iThisThaumsDaily) .. " daily)]")
        end
        if (bScreenreaderMode == false) then
          Note("")
        end
      end
    end
  end
  Note("(end of spellcast stats)")
end -- End of spell stats


-- Show order info on a specific order #
function QuowOrderInfo(iOrderID)
  iOrderID = tonumber(iOrderID)
  if (sQuowOrders[iOrderID] == nil) then
    return
  end
  if (bScreenreaderMode == false) then
    Note("")
  end
  ColourNote("darkorange", "", "Quow's Mindspace Order info for:")
  if (bScreenreaderMode == false) then
    ColourNote("silver", "", "================================")
  end
  Hyperlink("!!bff25338e014986ba3b56e2c:QuowOrderInfo(" .. iOrderID .. ")", sQuowOrders[iOrderID][1], "Show Order info", "yellow", "", 0, true)
  Note("")
  ColourNote("silver", "", "(" .. sQuowOrders[iOrderID][2] .. ")")
  if (bScreenreaderMode == false) then
    Note("")
  end
  ColourNote("darkorange", "", "Primary skills:")
  local iPrimaries = 0
  ColourTell("cyan", "", "offensive")
  ColourTell("silver", "", ", ", "cyan", "", "defensive")
  ColourTell("silver", "", ", ", "cyan", "", "misc")
  ColourTell("silver", "", ", ", "cyan", "", "special")
  for iSkillNum, sSkillName in ipairs(iQuowSkillOrder) do
    for _, iThisOrder in pairs(sQuowSkillTree[sSkillName][2]) do
      if (iThisOrder == iOrderID) then
        ColourTell("silver", "", ", ", "cyan", "", sSkillName)
        iPrimaries = iPrimaries + 1
      end
    end
  end
  ColourTell("silver", "", ", ", "cyan", "", "points")
  Note("")

  -- We want to now find spells this Order could be known/good for
  local sUniquelyBestSpells, sJointBestSpells, iTotalMethods, iThisDifficulty = {}, {}, 0, 0
  -- Loop through all spells
  for sKey, iValue in pairs(objQuowSpellData) do
    if (iValue[7] == false) then
      local iOrderCounts = {}
      iTotalMethods = 0
      iThisDifficulty = 0
      -- Loop through the methods of this spell
      for _, sMethodCheck in pairs(iValue[6]) do
        -- Add up for the average method-difficulty of this spell
        iTotalMethods = iTotalMethods + 1
        iThisDifficulty = iThisDifficulty + sMethodCheck[11]
        -- Find orders with a primary matching this method and tot them up for each order and each method
        for __, iThisOrder in pairs(sQuowSkillTree[sMethodCheck[1]][2]) do
          if (iOrderCounts[iThisOrder] == nil) then
            iOrderCounts[iThisOrder] = 0
          end
          iOrderCounts[iThisOrder] = iOrderCounts[iThisOrder] + 1
        end
      end
      -- For this current spell, we now have a grand total of the primaries each order has for it's methods, find the best
      local iMostOrder, iBestOrder, bJointTop = 0, 0, false
      for iOrdID, iPrimaries in pairs(iOrderCounts) do
        if (iPrimaries > iMostOrder) then
          iMostOrder = iPrimaries
          iBestOrder = iOrdID
          bJointTop = false
        elseif (iPrimaries == iMostOrder) then
          bJointTop = true
          -- Only replace the best, if the previous best wasn't the order we're currently looking up
          if (iBestOrder ~= iOrderID) then
            iBestOrder = iOrdID
          end
        end
      end
      -- Is this one of our best, and/or is it a joint-best?
      if (iBestOrder == iOrderID) then
        if (bJointTop == false) then
          table.insert(sUniquelyBestSpells, {sKey, (iThisDifficulty / iTotalMethods), iTotalMethods, iOrderCounts[iOrderID]})
        else
          table.insert(sJointBestSpells, {sKey, (iThisDifficulty / iTotalMethods), iTotalMethods, iOrderCounts[iOrderID]})
        end
      end
    end -- Not a witch spell
  end -- Spell loop
  -- Sort those tables!
  table.sort(sUniquelyBestSpells, QuowSortBestOrder)
  table.sort(sJointBestSpells, QuowSortBestOrder)

  if (bScreenreaderMode == false) then
    Note("")
  end
  if (#sUniquelyBestSpells == 0) then
    Note("This Order has no spells in which it has more primaries than any other Order.")
  elseif (#sUniquelyBestSpells == 1) then
    Note("This Order has exactly one spell in which it has more primaries than any other Order:")
  else
    Note(#sUniquelyBestSpells .. " spells this Order has more primaries than ANY other Order, hardest to easiest:")
  end
  local iBestCount = 0
  for __, objBestSpell in ipairs(sUniquelyBestSpells) do
    iBestCount = iBestCount + 1
    if (iBestCount > 1) then
      Tell(", ")
    end
    Hyperlink ("!!bff25338e014986ba3b56e2c:QuowShowSpell(" .. objBestSpell[1] .. ")", objQuowSpellData[objBestSpell[1]][2], "Spell details", "cyan", "", 0)
    if (bScreenreaderMode == false) then
      ColourTell("silver", "", " [" .. math.floor(objBestSpell[2]) .. "]")
    end
  end
  if (iBestCount > 0) then
    Note("")
  end

  if (bScreenreaderMode == false) then
    Note("")
  end
  if (#sJointBestSpells == 0) then
    Note("This Order has no spells in which it has equally joint top primaries with another Order.")
  elseif (#sJointBestSpells == 1) then
    Note("This Order has exactly one spell in which it has joint top primaries than another Order:")
  else
    Note(#sJointBestSpells .. " spells this Order has equally top primaries to another Order, hardest to easiest:")
  end
  local iJointCount = 0
  for __, objJointSpell in ipairs(sJointBestSpells) do
    iJointCount = iJointCount + 1
    if (iJointCount > 1) then
      Tell(", ")
    end
    Hyperlink ("!!bff25338e014986ba3b56e2c:QuowShowSpell(" .. objJointSpell[1] .. ")", objQuowSpellData[objJointSpell[1]][2], "Spell details", "cyan", "", 0)
    if (bScreenreaderMode == false) then
      ColourTell("silver", "", " [" .. math.floor(objJointSpell[2]) .. "]")
    end
  end
  if (iJointCount > 0) then
    Note("")
  end

  if (bScreenreaderMode == false) then
    Note("")
  end
  ColourNote("darkorange", "", "End of Quow's Mindspace Order info.")
  if (bScreenreaderMode == false) then
    Note("")
  end
end

-- Used for third-party plugins, eg CowBar, to force screenreader mode a certain way
function ScreenreaderForceOn()
  if (bScreenreaderMode == false) then
    --ColourNote("silver", "", "Quow's mindspace plugin will now try to output some things in a simpler way.")
    bScreenreaderMode = true
    SetVariable("bMindspaceReader", tostring(bScreenreaderMode))
  end
end
function ScreenreaderForceOff()
  if (bScreenreaderMode == true) then
    --ColourNote("silver", "", "Quow's mindspace plugin will now output in full colour numbers mode.")
    bScreenreaderMode = false
    SetVariable("bMindspaceReader", tostring(bScreenreaderMode))
  end
end

-- Processing received skills
objSkills = {}
objStatsBase = {[1] = 0, [2] = 0, [3] = 0, [4] = 0, [5] = 0}
objStatsCurrent = {[1] = 0, [2] = 0, [3] = 0, [4] = 0, [5] = 0}

-- Receive skills
function MindspaceSkillsReceiver(sSkillsData)
  objSkills = json.decode(sSkillsData)
  bNeedingBGSkills = false
  -- Did we get stats AND skills yet?
  if (bWaitingForUpdate == true and bNeedingBGSkills == false and bNeedingBGStats == false) then
    BonusCalculator()
  end
end

-- Parse a stat line
function StatParse(sName, sLine, wildcards)
  EnableTrigger(sName, false)
  local iStat = tonumber(string.sub(sName, 6))
  objStatsCurrent[iStat] = tonumber(wildcards[1])
  objStatsBase[iStat] = objStatsCurrent[iStat]
  if (wildcards[2] ~= "") then
    local iBonusStat = tonumber(wildcards[2])
    if (iBonusStat ~= nil) then
      -- This stat is modified by a bonus, so remove it for the base stat
      objStatsBase[iStat] = objStatsCurrent[iStat] - iBonusStat
    end
  end
  iGotStats = iGotStats + 1
  if (iGotStats == 5) then
    bNeedingBGStats = false
    -- Did we get stats AND skills yet?
    if (bWaitingForUpdate == true and bNeedingBGSkills == false and bNeedingBGStats == false) then
      BonusCalculator()
    end
  end
end

-- Some real skill data for stat-weightings
objRealSkillData = {
  ["magic.spells.special"] =               {{0, 0, 2, 0, 3}, "special"},
  ["magic.methods.elemental.air"] =        {{3, 0, 2, 0, 0}, "air"},
  ["magic.methods.elemental.earth"] =      {{3, 0, 2, 0, 0}, "earth"},
  ["magic.methods.elemental.fire"] =       {{3, 0, 2, 0, 0}, "fire"},
  ["magic.methods.elemental.water"] =      {{3, 0, 2, 0, 0}, "water"},
  ["magic.methods.mental.animating"] =     {{0, 0, 5, 0, 0}, "animating"},
  ["magic.methods.mental.channeling"] =    {{0, 0, 5, 0, 0}, "channeling"},
  ["magic.methods.mental.charming"] =      {{0, 0, 5, 0, 0}, "charming"},
  ["magic.methods.mental.convoking"] =     {{0, 0, 5, 0, 0}, "convoking"},
  ["magic.methods.mental.cursing"] =       {{0, 0, 5, 0, 0}, "cursing"},
  ["magic.methods.physical.binding"] =     {{0, 3, 2, 0, 0}, "binding"},
  ["magic.methods.physical.brewing"] =     {{0, 3, 2, 0, 0}, "brewing"},
  ["magic.methods.physical.chanting"] =    {{0, 3, 2, 0, 0}, "chanting"},
  ["magic.methods.physical.dancing"] =     {{0, 3, 2, 0, 0}, "dancing"},
  ["magic.methods.physical.enchanting"] =  {{0, 3, 2, 0, 0}, "enchanting"},
  ["magic.methods.physical.evoking"] =     {{0, 3, 2, 0, 0}, "evoking"},
  ["magic.methods.physical.healing"] =     {{0, 3, 2, 0, 0}, "healing"},
  ["magic.methods.physical.scrying"] =     {{0, 3, 2, 0, 0}, "scrying"},
  ["magic.methods.spiritual.abjuring"] =   {{0, 0, 2, 0, 3}, "abjuring"},
  ["magic.methods.spiritual.banishing"] =  {{0, 0, 2, 0, 3}, "banishing"},
  ["magic.methods.spiritual.conjuring"] =  {{0, 0, 2, 0, 3}, "conjuring"},
  ["magic.methods.spiritual.divining"] =   {{0, 0, 2, 0, 3}, "divining"},
  ["magic.methods.spiritual.summoning"] =  {{0, 0, 2, 0, 3}, "summoning"},
  ["magic.items.held.wand"] =              {{0, 1, 2, 0, 2}, "wand"},
  ["magic.items.held.rod"] =               {{0, 1, 2, 0, 2}, "rod"},
  ["magic.items.held.staff"] =             {{0, 1, 2, 0, 2}, "staff"},
  ["magic.items.worn.amulet"] =            {{0, 1, 2, 0, 2}, "amulet"},
  ["magic.items.worn.ring"] =              {{0, 1, 2, 0, 2}, "ring"},
  ["magic.items.talisman"] =               {{0, 1, 2, 0, 2}, "talisman"},
  ["crafts.smithing.gold"] =               {{0, 2, 2, 1, 0}, "gold"},
  ["crafts.smithing.silver"] =             {{0, 2, 2, 1, 0}, "silver"},
  ["crafts.carpentry.turning"] =           {{0, 2, 2, 1, 0}, "turning"},
  ["crafts.carpentry.whittling"] =         {{0, 2, 2, 1, 0}, "whittling"},
  ["crafts.husbandry.plant.herbal"] =      {{0, 0, 3, 0, 2}, "herbal"},
  ["crafts.pottery.forming.shaping"] =     {{0, 3, 2, 0, 0}, "shaping"},
  ["crafts.materials.weaving"] =           {{0, 2, 2, 1, 0}, "weaving"},
}
-- Calculate raw and modified bonuses based on skill levels, and stats, now
function BonusCalculator()
  bWaitingForUpdate = false
  local iStatProduct, iMultiplicator, iBaseBonus, iFinalBonus
  for sThisSkill, iLevel in pairs(objSkills) do
    if (objRealSkillData[sThisSkill] ~= nil) then
      -- Calculate the "stat product" - a multiplier based on the skill's stat weighting, and your stats
      iStatProduct = 1
      if (sThisSkill ~= "magic.spells.special") then
        -- Modified stats for non-ma.sp.sp skill (eg with boosters)
        for iN = 1, 5 do
          if (objStatsCurrent[iN] > 0 and objRealSkillData[sThisSkill][1][iN] > 0) then
            for iJ = 1, objRealSkillData[sThisSkill][1][iN] do
              iStatProduct = iStatProduct * objStatsCurrent[iN]
            end
          end
        end
      else
        -- Raw stats for ma.sp.sp mindspace
        for iN = 1, 5 do
          if (objStatsBase[iN] > 0 and objRealSkillData[sThisSkill][1][iN] > 0) then
            for iJ = 1, objRealSkillData[sThisSkill][1][iN] do
              iStatProduct = iStatProduct * objStatsBase[iN]
            end
          end
        end
      end
      -- We have the stats product, now do the multiplicator
      iMultiplicator = 1 / 9.8 * math.log(iStatProduct) - 0.25
      if (iMultiplicator < 0) then 
        iMultiplicator = 0
      end
      -- Calculate the base bonus (based purely off level)
      iBaseBonus = 0
      if (iLevel <= 0) then 
        iBaseBonus = 0
      elseif (iLevel <= 20) then 
        iBaseBonus = 5 * iLevel
      elseif (iLevel <= 40) then 
        iBaseBonus = math.floor(2.5 * (iLevel - 20) + 100)
      elseif (iLevel <= 60) then 
        iBaseBonus = (iLevel-40) + 150
      else 
        iBaseBonus = math.floor(0.5 * (iLevel - 60) + 170)
      end
      -- Now finally the base bonus times the stat multiplicator = final bonus
      iFinalBonus = math.floor(iMultiplicator * iBaseBonus)
      -- And feed that bonus in as appropriate
      if (sThisSkill ~= "magic.spells.special") then
        --Note("'" .. sCurrentCharacter .. "', '" .. sThisSkill .. "' level=" .. iLevel .. ", old bonus=" .. tostring(objMindspaceSkillsPerAlt[sCurrentCharacter][objRealSkillData[sThisSkill][2]]) .. ", new=" .. iFinalBonus)
        objMindspaceSkillsPerAlt[sCurrentCharacter][objRealSkillData[sThisSkill][2]] = iFinalBonus
      else
        --Note("Old mindspace=" .. iMindspaceSpecialPerAlt[sCurrentCharacter] .. ", New= " .. (iFinalBonus + 30))
        iMindspaceSpecialPerAlt[sCurrentCharacter] = iFinalBonus + 30
      end
    end -- Valid skill
  end -- Loop through the skills
  ColourNote ("orange", "", "Skills and mindspace calculated, you can now spellcheck with:  mindspace <acronym>  or lookup a skill with:  mindspace <skill>")
  SetVariable("SkillsPerAlt", json.encode(objMindspaceSkillsPerAlt))
  SetVariable("SpecialPerAlt", json.encode(iMindspaceSpecialPerAlt))
end -- BonusCalculator


-- Sorting function on bonuses
function QuowSortBonuses(a, b)
  return a[1] > b[1]
end

-- Parse the mindspace value
bNoisyMindspace = true
function QuowMindspaceParse (sName, sLine, wildcards)
  EnableTrigger("QuowMindspaceCheck", false)
  EnableTrigger("List_QuowMindspaceCheck", false)
  local iThisSpace = tonumber(wildcards.bonus)
  iMindspaceSpecialPerAlt[sCurrentCharacter] = iThisSpace + 30
  if (bNoisyMindspace == true) then
    ColourNote("silver", "", "Mindspace automatically set to ", "orange", "", tostring(iMindspaceSpecialPerAlt[sCurrentCharacter]))
  end
  SetVariable("SpecialPerAlt", json.encode(iMindspaceSpecialPerAlt))
end

-- This function is needed to prepare the mindspace values and set them back to 0 when a user sends the "spells" commands to the mud
function QuowResetSpells (sName, sLine, wildcards)
  Send(sLine)
  -- Reset current spells
  objSpellsSeen = {}
  for sKey, iValue in pairs (objSpellsKnownPerAlt[sCurrentCharacter]) do
    objSpellsSeen[sKey] = 1
  end
  objSpellsKnownPerAlt[sCurrentCharacter] = {}
  -- Reset temporary counters for JUST this listing
  iQuowTotalMS = 0
  iQuowDefMS = 0
  iQuowOffMS = 0
  iQuowMiscMS = 0
  iQuowSpells = 0
  iQuowDefSpells = 0
  iQuowOffSpells = 0
  iQuowMiscSpells = 0
  iQuowMSProcess = 0
  iQuowCatSeen = 0
end

-- Triggered on seeing the "You know the following <category>" line from the MUD before a cat-listing, so we know what category is coming up
function QuowSpellStart (sName, sLine, wildcards)
  EnableTrigger("QuowLineCheck", true)
  if (wildcards[1] == "defensive ") then
    iQuowMSProcess = 1
    iQuowDefMS = 0
    iQuowDefSpells = 0
  elseif (wildcards[1] == "offensive ") then
    iQuowMSProcess = 2
    iQuowOffMS = 0
    iQuowOffSpells = 0
  elseif (wildcards[1] == "misc ") then
    iQuowMSProcess = 3
    iQuowMiscMS = 0
    iQuowMiscSpells = 0
  else
    iQuowMSProcess = 0
    iQuowMiscMS = 0
    iQuowOffMS = 0
    iQuowDefMS = 0
    iQuowSpells = 0
    iQuowDefSpells = 0
    iQuowOffSpells = 0
    iQuowMiscSpells = 0
  end
end

-- Triggered when we are waiting for a spell-list from the MUD, so we can look and see if we find any spell names anywhere
function QuowSpellCheck (sName, sLine, wildcards)
  -- Above probably not needed...=
  -- Blank line?  Probably a break between categories...
  if (sLine == "") then
    EnableTrigger("QuowLineCheck", false)
    EnableTrigger("List_QuowLineCheck", false)
    QuowReportSpellSpace()
    iQuowCatSeen = iQuowCatSeen + 1
    if (iQuowCatSeen == 3 or iQuowMSProcess == 0) then
      DeleteTimer("QuowSpellsSeen")
      QuowReportSpellDifferences()
    else
      -- Add timer to count spells as "definitely all seen" after a while of seeing the very first one
      DeleteTimer("QuowSpellsSeen")
      AddTimer ("QuowSpellsSeen", 0, 0, 1, "", 17445, "QuowReportSpellDifferences")
    end
    return
  end
  local bAnyFound = false
  -- See if any spells appear
  for sKey, iValue in pairs (objQuowSpellData) do
    if (string.find(sLine, sKey, 1, true)) then
      bAnyFound = true
      if (objSpellsSeen[iValue[2]] == nil) then
        objSpellsSeen[iValue[2]] = 2
      else
        objSpellsSeen[iValue[2]] = 3
      end
      objSpellsKnownPerAlt[sCurrentCharacter][iValue[2]] = 1
      iQuowTotalMS = iQuowTotalMS + iValue[1]
      iQuowSpells = iQuowSpells + 1
      if (iQuowMSProcess == 1) then
        iQuowDefMS = iQuowDefMS + iValue[1]
        iQuowDefSpells = iQuowDefSpells + 1
      elseif (iQuowMSProcess == 2) then
        iQuowOffMS = iQuowOffMS + iValue[1]
        iQuowOffSpells = iQuowOffSpells + 1
      elseif (iQuowMSProcess == 3) then
        iQuowMiscMS = iQuowMiscMS + iValue[1]
        iQuowMiscSpells = iQuowMiscSpells + 1
      end
    end
  end

  if (bAnyFound == false) then
    EnableTrigger("QuowLineCheck", false)
    DeleteTimer("QuowSpellsSeen")
    QuowReportSpellSpace()
    QuowReportSpellDifferences()
    return
  end
end

-- Report the spellspace values for the last category viewed (and a running total so far)
function QuowReportSpellSpace()
  if (iQuowMSProcess == 1) then
    ColourNote("orange", "", "Defensive spells: " .. tostring(iQuowDefMS) .. " [" .. tostring(iQuowDefSpells) .. " spells]")
    iQuowDefMS = 0
    iQuowDefSpells = 0
  elseif (iQuowMSProcess == 2) then
    ColourNote("orange", "", "Offensive spells: " .. tostring(iQuowOffMS) .. " [" .. tostring(iQuowOffSpells) .. " spells]")
    iQuowOffMS = 0
    iQuowOffSpells = 0
  elseif (iQuowMSProcess == 3) then
    ColourNote("orange", "", "Misc spells: " .. tostring(iQuowMiscMS) .. " [" .. tostring(iQuowMiscSpells) .. " spells]")
    iQuowMiscMS = 0
    iQuowMiscSpells = 0
  end
  if (iMindspaceSpecialPerAlt[sCurrentCharacter] ~= nil) then
    ColourNote("orange", "", "Total Mindspace: " .. tostring(iQuowTotalMS) .. " / " .. tostring(iMindspaceSpecialPerAlt[sCurrentCharacter]) .. " [" .. tostring(iQuowSpells) .. " spells, " .. tostring(tonumber(iMindspaceSpecialPerAlt[sCurrentCharacter]) - tonumber(iQuowTotalMS)) .. " mindspace free]\n")
  else
    ColourNote("orange", "", "Total Mindspace: " .. tostring(iQuowTotalMS) .. " [" .. tostring(iQuowSpells) .. " spells]\n")
    ColourNote("red", "", "Please issue the command 'mindspace skills' to have the plugin calculate your total mindspace")
  end
end

-- Report a difference in what spells we had LAST time for this char, and what we have seen THIS time
function QuowReportSpellDifferences()
  -- Loop through what spells we saw, compare to last-known spells etc.
  -- 1 we had it but don't (lost), 2 we didn't but now have it (gained), 3 it's unchanged still got it
  local iGainedSpells = 0
  local iLostSpells = 0
  for sKey, iValue in pairs (objSpellsSeen) do
    if (iValue == 1) then
      iLostSpells = iLostSpells + 1
    elseif (iValue == 2) then
      iGainedSpells = iGainedSpells + 1
    end
  end
  -- Report
  if (iGainedSpells > 0) then
    ColourTell("darkorange", "", string.gsub(sCurrentCharacter, "%f[%a].", string.upper) .. " has GAINED the following spell")
    if (iGainedSpells > 1) then 
      ColourTell("darkorange", "", "s")
    end
    ColourNote("darkorange", "", " since last update: ")
    local iCurCount = 0
    for sKey, iValue in pairs (objSpellsSeen) do
      if (iValue == 2) then
        Hyperlink ("!!bff25338e014986ba3b56e2c:QuowShowSpell(" .. sAcronymToSpell[sKey] .. ")", sKey, "Spell details", "cyan", "", 0)
        iCurCount = iCurCount + 1
        if (iCurCount < iGainedSpells) then
          Tell(", ")
        end
      end
    end
  end
  if (iLostSpells > 0) then
    if (iGainedSpells > 0) then
      Note("")
    end
    ColourTell("red", "", string.gsub(sCurrentCharacter, "%f[%a].", string.upper) .. " has LOST the following spell")
    if (iLostSpells > 1) then 
      ColourTell("red", "", "s")
    end
    ColourNote("red", "", " since last update: ")
    local iCurCount = 0
    for sKey, iValue in pairs (objSpellsSeen) do
      if (iValue == 1) then
        Hyperlink ("!!bff25338e014986ba3b56e2c:QuowShowSpell(" .. sAcronymToSpell[sKey] .. ")", sKey, "Spell details", "cyan", "", 0)
        iCurCount = iCurCount + 1
        if (iCurCount < iLostSpells) then
          Tell(", ")
        end
      end
    end
  end
  if (iLostSpells > 0 or iGainedSpells > 0) then
    Note("")
    Note("")
  end
  objSpellsSeen = {}
  -- And finally save our spells to file
  SetVariable("SpellsPerAlt", json.encode(objSpellsKnownPerAlt))
end

-- Sorting function on bonuses, for difficulty lister
function QuowSortDifficulties(a, b)
  return a[2] < b[2]
end
-- Sorting function on mindspaces
function QuowSortMindspace(a, b)
  return a[6] < b[6]
end
-- Sorting function on best order spells
function QuowSortBestOrder(a, b)
  return a[2] > b[2]
end
-- List spells by "difficulty"
function CalculateDifficultyList(bWitchSpells, sSpellTypes, iMaxMindspace, bSpellList)
  if (bWitchSpells == nil) then
    bWitchSpells = false
  end
  if (sSpellTypes == nil) then
    sSpellTypes = ""
  end
  if (iMaxMindspace == nil) then
    iMaxMindspace = 0
  end
  if (bSpellList == nil) then
    bSpellList = false
  end
  local iSpellDifficulty = {}
  local iThisDifficulty = 0
  local iTotalMethods = 0
  local sMethodString = ""
  local iMyBonus = 0
  local iSuccessChance = 0
  local iZeroSuccess, iHalfSuccess, iFullSuccess = 0, 0, 0
  for sKey, iValue in pairs(objQuowSpellData) do
    iThisDifficulty = 0
    sMethodString = ""
    -- Witch or wizzard!?
    if ((bWitchSpells == false and iValue[7] == false) or (bWitchSpells == true and iValue[7] == true)) then
      -- All spells, or a specific category of spell?
      if (sSpellTypes == "" or (sSpellTypes == "defensive" and iValue[3] == "Defensive") or (sSpellTypes == "offensive" and iValue[3] == "Offensive") or (sSpellTypes == "misc" and iValue[3] == "Miscellaneous")) then
        -- Check if we need to mindspace max-filter it
        if (iMaxMindspace == 0 or (iValue[1] <= iMaxMindspace)) then
          iThisDifficulty = 0
          iTotalMethods = 0
          iZeroSuccess = 0
          iHalfSuccess = 0
          iFullSuccess = 0
          iSuccessChance = 0
          -- Loop through each method stage of this spell
          for _, sMethodCheck in pairs(iValue[6]) do
            -- Method for desired spell, add up method list strings and colour-graded skillchecks
            iTotalMethods = iTotalMethods + 1
            iThisDifficulty = iThisDifficulty + sMethodCheck[11]
            sMethodString = sMethodString .. sMethodCheck[1] .. ","
            iMyBonus = objMindspaceSkillsPerAlt[sCurrentCharacter][sMethodCheck[1]]
            if (iMyBonus == nil) then
              iMyBonus = 0
            end
            if (iMyBonus > sMethodCheck[10]) then
              -- How many "full success/100%'ers" do we have (well, 90%'ers')
              iFullSuccess = iFullSuccess + 1
            elseif (iMyBonus > sMethodCheck[4]) then
              -- Ok then, how about at least over the half way point?
              iHalfSuccess = iHalfSuccess + 1
            else
              -- No success at all in this method then...
              iZeroSuccess = iZeroSuccess + 1
            end
          end
          -- An overall success rating of this spell in three colour categories
          iSuccessChance = 1
          if (iFullSuccess == iTotalMethods) then
            -- Only full success if you got 90%+ on EVERY method
            iSuccessChance = 3
          elseif (iZeroSuccess == 0) then
            -- Halfway success if we don't TOTALLY fail on any single method
            iSuccessChance = 2
          else
            -- At least one method classes as a total fail, so class whole spell as a total fail
            iSuccessChance = 1
          end
          -- And work out the AVERAGE difficulty of this spell
          iThisDifficulty = iThisDifficulty / iTotalMethods
          -- And the nice user-displayed string of method checks involved minus final comma
          sMethodString = string.sub(sMethodString, 1, -2)
          -- And store all the info for this spell & checks in a table ready for sorting and displaying back to the user later
          table.insert(iSpellDifficulty, {sKey, iThisDifficulty, iTotalMethods, sMethodString, iSuccessChance, iValue[1]})
        end -- Mindspace size match?
      end -- Any spell, or misc/off/def?
    end -- Witch or wizzard?
  end -- Loop through all spells?
  -- Sort the table by average difficulty value
  if (bSpellList == false) then
    table.sort(iSpellDifficulty, QuowSortDifficulties)
  else
    table.sort(iSpellDifficulty, QuowSortMindspace)
  end
  -- Prepare an object for each spell's data
  local objThisSpell
  Note("")

  -- Sorted format output
  if (bSpellList == false) then
    if (sSpellTypes == "") then
      ColourTell("orange", "", "All")
    elseif (sSpellTypes == "defensive") then
      ColourTell("orange", "", "Defensive")
    elseif (sSpellTypes == "offensive") then
      ColourTell("orange", "", "Offensive")
    elseif (sSpellTypes == "misc") then
      ColourTell("orange", "", "Miscellaneous")
    end
    if (bWitchSpells == true) then
      ColourTell("orange", "", " Witch")
    end
    ColourNote("orange", "", " spells from easiest to hardest, sorted by average method difficulty:")
    if (iMaxMindspace > 0) then
      ColourNote("orange", "", "(with a maximum mindspace of " .. iMaxMindspace .. ")")
    end
    local sColour = {
      [1] = "red",
      [2] = "darkorange",
      [3] = "silver",
    }
    -- Loop through the now sorted table, and display the nice text lines for each spell, with hyperlinks
    for sKey, iValue in pairs(iSpellDifficulty) do
      objThisSpell = objQuowSpellData[iValue[1]]
      ColourTell(sColour[iValue[5]], "", string.format("%-3s ", math.floor(iValue[2])) .. ": ")
      Hyperlink ("!!bff25338e014986ba3b56e2c:QuowShowSpell(" .. iValue[1] .. ")", objThisSpell[2], "Show full details for this spell", "cyan", "", 0)
      ColourTell("silver", "", " - " .. iValue[1] .. " (")
      ColourTell("darkorange", "", iValue[3] .. " methods : ")
      Tell(iValue[4])
      ColourNote("silver", "", ")")
    end -- Spell loop
  else
  -- Spells format output
    -- Loop through the now sorted table, and display the nice text lines for each spell, with hyperlinks
    local iTotalSpells, iTotalMindspace = 0, 0
    for sKey, iValue in pairs(iSpellDifficulty) do
      objThisSpell = objQuowSpellData[iValue[1]]
      iTotalSpells = iTotalSpells + 1
      iTotalMindspace = iTotalMindspace + objThisSpell[1]
      local sCol = "cyan"
      if (objSpellsKnownPerAlt[sCurrentCharacter][objThisSpell[2]] ~= nil) then
        sCol = "green"
      end
      Hyperlink ("!!bff25338e014986ba3b56e2c:QuowShowSpell(" .. iValue[1] .. ")", objThisSpell[2], "Show full details for this spell", sCol, "", 0)
      ColourTell("cyan", "", string.format("%-" .. (6-string.len(objThisSpell[2])) .. "s ", " "))
      ColourTell("silver", "", " : " .. iValue[1] .. " (" .. sTypeShort[objThisSpell[3]] .. ") [")
      Tell("size:" .. objThisSpell[1] .. ", GP:" ..  objThisSpell[4])
      ColourNote("silver", "", "]")
    end -- Spell loop

    ColourTell("orange", "", "There are a total of " .. iTotalSpells .. " known ")
    if (sSpellTypes == "defensive") then
      ColourTell("orange", "", "Defensive ")
    elseif (sSpellTypes == "offensive") then
      ColourTell("orange", "", "Offensive ")
    elseif (sSpellTypes == "misc") then
      ColourTell("orange", "", "Miscellaneous ")
    end
    if (bWitchSpells == true) then
      ColourTell("orange", "", "Witch ")
    else
      ColourTell("orange", "", "Wizzard ")
    end
    ColourTell("orange", "", "spells")
    if (iMaxMindspace > 0) then
      ColourTell("orange", "", " (with max size of " .. iMaxMindspace .. ")")
    end
    ColourNote("orange", "", ", for a total mindspace of " .. iTotalMindspace)
    Note("")
  end
end

-- Spell tracking, count how many of each and every spell you cast, maybe other stats later?
function QuowTrackSpells(sName, sLine, wildcards)
  local sThisSpell = wildcards[1]
  if (objQuowSpellData[sThisSpell] == nil) then
    return
  end
  local iNow = os.time()
  -- Create it for this alt if needed
  if (objSpellInfoPerAlt[sCurrentCharacter] == nil) then
    objSpellInfoPerAlt[sCurrentCharacter] = {}
  end
  -- Prime it if this is the first time for this spell
  if (objSpellInfoPerAlt[sCurrentCharacter][sThisSpell] == nil) then
    objSpellInfoPerAlt[sCurrentCharacter][sThisSpell] = {["first"] = iNow, ["last"] = iNow, ["casts"] = 0, }
  end
  -- Count it
  objSpellInfoPerAlt[sCurrentCharacter][sThisSpell].last = iNow
  objSpellInfoPerAlt[sCurrentCharacter][sThisSpell].casts = objSpellInfoPerAlt[sCurrentCharacter][sThisSpell].casts + 1
  SetVariable("SpinfoPerAlt", json.encode(objSpellInfoPerAlt))
end

]]>
</script> 
<!--  Aliases  -->
<aliases>
  <alias
   match="mindspace old"
   enabled="y"
   ignore_case="y"
   sequence="29"
   script="QuowMindspaceGetter"
  > 
  </alias>
  <alias
   match="^mindspace (.+)$"
   enabled="y"
   regexp="y"
   ignore_case="y"
   sequence="30"
   script="QuowMindspaceSetter"
  > 
  </alias>
  <alias
   match="^mindspace$"
   enabled="y"
   regexp="y"
   ignore_case="y"
   sequence="30"
   script="QuowMindspaceSetter"
  > 
  </alias>

  <alias
   match="help mindspace"
   enabled="y"
   ignore_case="y"
   sequence="30"
   script="QuowMindspaceHelp"
  > 
  </alias>
  <alias
   match="spells"
   enabled="y"
   sequence="40"
   script="QuowResetSpells"
  > 
  </alias>
  <alias
   match="spells uncategorised"
   enabled="y"
   sequence="40"
   script="QuowResetSpells"
  > 
  </alias>
  <alias
   match="spells uncategorized"
   enabled="y"
   sequence="40"
   script="QuowResetSpells"
  > 
  </alias>
</aliases>
<!--  Triggers  -->
<triggers>
  <trigger
   enabled="y"
   ignore_case="n"
   keep_evaluating="y"
   match="^You know the following (defensive |offensive |misc |)magic spells?:$"
   regexp="y"
   sequence="40"
   script="QuowSpellStart"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="y"
   keep_evaluating="y"
   match="$"
   regexp="y"
   script="QuowSpellCheck"
   sequence="35"
   name="QuowLineCheck"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| special......... {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowMindspaceParse"
   sequence="35"
   name="QuowMindspaceCheck"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (air...........) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="air"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (earth.........) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="earth"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (fire..........) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="fire"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (water.........) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="water"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (animating.....) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="animating"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (channeling....) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="channeling"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (charming......) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="charming"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (convoking.....) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="convoking"
  >
  </trigger>

  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (cursing.......) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="cursing"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (binding.......) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="binding"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (brewing.......) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="brewing"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (chanting......) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="chanting"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (dancing.......) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="dancing"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (enchanting....) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="enchanting"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (evoking.......) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="evoking"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (healing.......) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="healing"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (scrying.......) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="scrying"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (abjuring......) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="abjuring"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (banishing.....) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="banishing"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (conjuring.....) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="conjuring"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (divining......) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="divining"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (summoning.....) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="summoning"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (wand..........) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="wand"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (rod...........) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="rod"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (staff.........) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="staff"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (amulet........) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="amulet"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (ring..........) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="ring"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| (talisman........) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="talisman"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| (gold............) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="gold"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| (silver..........) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="silver"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| (turning.........) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="turning"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| (whittling.......) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="whittling"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (herbal........) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="herbal"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| \| (shaping.......) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="shaping"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="y"
   omit_from_output="y"
   match="\| \| (weaving.........) {1,4}(?P<level>\d{1,4}) {1,4}(?P<bonus>\d{1,4})"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="weaving"
  >
  </trigger>
  <trigger
   enabled="y"
   ignore_case="n"
   keep_evaluating="y"
   match="Constitution \.\.\. ([0-9]{1,2})(?: \((-?[0-9]{1,2})\))?"
   regexp="y"
   script="StatParse"
   sequence="21"
   name="Stat_1"
  >
  </trigger>
  <trigger
   enabled="y"
   ignore_case="n"
   keep_evaluating="y"
   match="Dexterity \.\.\.\.\.\. ([0-9]{1,2})(?: \((-?[0-9]{1,2})\))?"
   regexp="y"
   script="StatParse"
   sequence="23"
   name="Stat_2"
  >
  </trigger>
  <trigger
   enabled="y"
   ignore_case="n"
   keep_evaluating="y"
   match="Intelligence \.\.\. ([0-9]{1,2})(?: \((-?[0-9]{1,2})\))?"
   regexp="y"
   script="StatParse"
   sequence="25"
   name="Stat_3"
  >
  </trigger>
  <trigger
   enabled="y"
   ignore_case="n"
   keep_evaluating="y"
   match="Strength \.\.\.\.\.\.\. ([0-9]{1,2})(?: \((-?[0-9]{1,2})\))?"
   regexp="y"
   script="StatParse"
   sequence="22"
   name="Stat_4"
  >
  </trigger>
  <trigger
   enabled="y"
   ignore_case="n"
   keep_evaluating="y"
   match="Wisdom \.\.\.\.\.\.\.\.\. ([0-9]{1,2})(?: \((-?[0-9]{1,2})\))?"
   regexp="y"
   script="StatParse"
   sequence="24"
   name="Stat_5"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.spells\.(special) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowMindspaceParse"
   sequence="35"
   name="List_QuowMindspaceCheck"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.elemental\.(air) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_air"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.elemental\.(earth) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_earth"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.elemental\.(fire) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_fire"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.elemental\.(water) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_water"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.mental\.(animating) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_animating"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.mental\.(channeling) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_channeling"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.mental\.(charming) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_charming"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.mental\.(convoking) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_convoking"
  >
  </trigger>

  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.mental\.(cursing) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_cursing"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.physical\.(binding) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_binding"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.physical\.(brewing) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_brewing"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.physical\.(chanting) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_chanting"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.physical\.(dancing) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_dancing"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.physical\.(enchanting) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_enchanting"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.physical\.(evoking) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_evoking"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.physical\.(healing) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_healing"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.physical\.(scrying) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_scrying"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.spiritual\.(abjuring) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_abjuring"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.spiritual\.(banishing) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_banishing"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.spiritual\.(conjuring) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_conjuring"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.spiritual\.(divining) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_divining"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.methods\.spiritual\.(summoning) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_summoning"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.items\.held\.(wand) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_wand"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.items\.held\.(rod) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_rod"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.items\.held\.(staff) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_staff"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.items\.worn\.(amulet) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_amulet"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.items\.worn\.(ring) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_ring"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^magic\.items\.(talisman) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_talisman"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^crafts\.smithing\.(gold) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_gold"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^crafts\.smithing\.(silver) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_silver"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^crafts\.carpentry\.(turning) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_turning"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^crafts\.carpentry\.(whittling) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_whittling"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^crafts\.husbandry\.plant\.(herbal) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_herbal"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^crafts\.pottery\.forming\.(shaping) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_shaping"
  >
  </trigger>
  <trigger
   enabled="n"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="y"
   match="^crafts\.materials\.(weaving) {1,30}(?P<level>[0-9]{1,4}) {1,5}(?P<bonus>[0-9]{1,4})$"
   regexp="y"
   script="QuowGetMethod"
   sequence="15"
   name="List_weaving"
  >
  </trigger>
  <trigger
   enabled="y"
   ignore_case="n"
   keep_evaluating="n"
   omit_from_output="n"
   match="^You prepare to cast (.+?)(?:(?> on | at ).+)?\.$"
   regexp="y"
   script="QuowTrackSpells"
   sequence="10"
   name="SpellTrack"
  >
  </trigger>
</triggers>
<!--  Timers  -->
<timers>
</timers>

</muclient>